{"ts": "2025-08-12 12:26:05.394", "level": "ERROR", "logger": "SQLQueryContextLogger", "msg": "[UNRESOLVED_COLUMN.WITH_SUGGESTION] A column, variable, or function parameter with name `CF`.`LocalFacilityIdentifier` cannot be resolved. Did you mean one of the following? [`EXMP_FAC_RC`.`LocalFacilityIdentifier`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`LocalId`, `EXMP_FAC_RC`.`PDModelCode`]. SQLSTATE: 42703; line 1 pos 59;\n'Project [*, 'min('EXMP_CP_RC_JOINED.ExemptionConditionIdRC) windowspecdefinition('EXMP_FAC_RC.LocalFacilityIdentifier, unspecifiedframe$()) AS var_lowest_ExemptionClaimConditonID_CP_RC#2232730]\n+- 'SubqueryAlias EXMP_CP_RC_JOINED\n   +- 'Join LeftOuter, 'and(('INT_CF_LINKS.ParticipatingCounterparty = 'EXMP_CP_RC.CounterpartyID), ('INT_CF_LINKS.ParticipatingCounterpartySourceSystemIdentifier = 'EXMP_CP_RC.CounterpartySourceSystemIdentifier))\n      :- 'Join LeftOuter, 'and(('CF.LocalFacilityIdentifier = 'INT_CF_LINKS.CreditFacility), ('CF.SourceSystemIdentifier = 'INT_CF_LINKS.CreditFacilitySourceSystemIdentifier))\n      :  :- 'Project [DeliveryEntity#2232988, ReportingDate#2232989, ReportingEntity#2233067, LocalFacilityIdentifier#2232990, SourceSystemIdentifier#2233070, CounterpartyID#2233088, CounterpartySourceSystemIdentifier#2233089, BaselIIProductType#2233005, PlNplIndicator#2233063, ProductProgram#2233065, SpecialisedLendingType#2233071, ExemptionFromAdvancedInternalRatingBasedApproach#2233031, SubFacilityFlag#2233087, DeliveryEntity#2233090, ReportingDate#2233091, LocalId#2233118, SourceSystemIdentifier#2233141, GlobalCounterpartyIdentifier#2233111, BaselIICounterpartyType#2233100, ExemptionFromAdvancedInternalRatingBasedApproach#2233109, CounterpartyID#2233160, CounterpartySourceSystemIdentifier#2233161, PDModelCode#2233167, LastPerformingPDModelCode#2233168, CounterpartyID#2233206, ... 34 more fields]\n      :  :  +- SubqueryAlias EXMP_FAC_RC\n      :  :     +- Join LeftOuter, ((((((((((((reporting_entity_id#2233245 = ReportingEntity#2233067) OR (reporting_entity_id#2233245 = *)) AND ((b2_pd_type_id#2233246 = BaselIIProductType#2233005) OR (b2_pd_type_id#2233246 = *))) AND ((lgd_rtg_model#2233251 = LGDModelCode#2233229) OR (lgd_rtg_model#2233251 = *))) AND ((pl_npl_indicator#2233263 = PlNplIndicator#2233063) OR (pl_npl_indicator#2233263 = *))) AND ((specialised_lending_type#2233264 = SpecialisedLendingType#2233071) OR (specialised_lending_type#2233264 = *))) AND ((cr_pd_program#2233249 = ProductProgram#2233065) OR (cr_pd_program#2233249 = *))) AND (((pd_rtg_model#2233244 = PDModelCode#2233167) OR (pd_rtg_model#2233244 = LastPerformingPDModelCode#2233168)) OR (pd_rtg_model#2233244 = *))) AND ((b2_cpty_type_id#2233248 = BaselIICounterpartyType#2233100) OR (b2_cpty_type_id#2233248 = *))) AND (((intercompany_flag#2233254 = InterCompanyFlag#2233210) = cast(Y as boolean)) OR (intercompany_flag#2233254 = *))) AND ((upper(sourced_exemption_id#2233262) = upper(coalesce(ExemptionFromAdvancedInternalRatingBasedApproach#2233031, ExemptionFromAdvancedInternalRatingBasedApproach#2233109))) OR (sourced_exemption_id#2233262 = *))) AND (((concat(ctpty_ssc#2233256, ctpty_uid#2233255) = LocalId#2233118) OR ((ctpty_ssc#2233256 = EPR) AND (ltrim(ctpty_uid#2233255, Some(0)) = ltrim(GlobalCounterpartyIdentifier#2233111, Some(0))))) OR (ctpty_uid#2233255 = *)))\n      :  :        :- Join LeftOuter, ((LocalFacilityIdentifier#2232990 = CreditFacilityID#2233221) AND (SourceSystemIdentifier#2233070 = CreditFacilitySourceSystemIdentifier#2233222))\n      :  :        :  :- Join LeftOuter, ((CounterpartyID#2233088 = CounterpartyID#2233206) AND (CounterpartySourceSystemIdentifier#2233089 = CounterpartySourceSystemIdentifier#2233207))\n      :  :        :  :  :- Join LeftOuter, ((CounterpartyID#2233088 = CounterpartyID#2233160) AND (CounterpartySourceSystemIdentifier#2233089 = CounterpartySourceSystemIdentifier#2233161))\n      :  :        :  :  :  :- Join LeftOuter, ((CounterpartyID#2233088 = LocalId#2233118) AND (CounterpartySourceSystemIdentifier#2233089 = SourceSystemIdentifier#2233141))\n      :  :        :  :  :  :  :- SubqueryAlias CF\n      :  :        :  :  :  :  :  +- Project [DeliveryEntity#2232988, ReportingDate#2232989, ReportingEntity#2233067, LocalFacilityIdentifier#2232990, SourceSystemIdentifier#2233070, CounterpartyID#2233088, CounterpartySourceSystemIdentifier#2233089, BaselIIProductType#2233005, PlNplIndicator#2233063, ProductProgram#2233065, SpecialisedLendingType#2233071, ExemptionFromAdvancedInternalRatingBasedApproach#2233031, SubFacilityFlag#2233087]\n      :  :        :  :  :  :  :     +- Filter (SubFacilityFlag#2233087 = N)\n      :  :        :  :  :  :  :        +- SubqueryAlias bsrc_d.int_202505.mainbank_integrated_creditfacility\n      :  :        :  :  :  :  :           +- Relation bsrc_d.int_202505.mainbank_integrated_creditfacility[DeliveryEntity#2232988,ReportingDate#2232989,LocalFacilityIdentifier#2232990,Default#2232991,DefaultDate#2232992,DefaultEndDate#2232993,NonperformingEndDate#2232994,NonperformingStartDate#2232995,PerformingIndicator#2232996,AccruedFeesAmountDebitCreditIndicator#2232997,AccruedFeesAmountReportingAmount#2232998,AccruedFeesAmountReportingCurrency#2232999,AccruedFeesAmountTransactionAmount#2233000,AccruedFeesAmountTransactionCurrency#2233001,AlternativeLocalReferenceIdentifier#2233002,ApprovedLossGivenDefaultRatingDate#2233003,ArrangementParticipationType#2233004,BaselIIProductType#2233005,BookType#2233006,BorrowingBaseReportingAmount#2233007,BorrowingBaseReportingCurrency#2233008,BorrowingBaseTransactionAmount#2233009,BorrowingBaseTransactionCurrency#2233010,BusinessSegment#2233011,ContractStatus#2233012,... 77 more fields] parquet\n      :  :        :  :  :  :  +- SubqueryAlias INT_CP\n      :  :        :  :  :  :     +- Project [DeliveryEntity#2233090, ReportingDate#2233091, LocalId#2233118, SourceSystemIdentifier#2233141, GlobalCounterpartyIdentifier#2233111, BaselIICounterpartyType#2233100, ExemptionFromAdvancedInternalRatingBasedApproach#2233109]\n      :  :        :  :  :  :        +- SubqueryAlias bsrc_d.int_202505.mainbank_integrated_counterparty\n      :  :        :  :  :  :           +- Relation bsrc_d.int_202505.mainbank_integrated_counterparty[DeliveryEntity#2233090,ReportingDate#2233091,AacAlphaCode#2233092,AlternativeLocalReferenceIdentifier#2233093,AnnualTurnoverReportingAmount#2233094,AnnualTurnoverReportingCurrency#2233095,AnnualTurnoverTransactionAmount#2233096,AnnualTurnoverTransactionCurrency#2233097,ApprovedUniformCounterpartyRating#2233098,ApprovedUniformCounterpartyRatingExpirationDate#2233099,BaselIICounterpartyType#2233100,BcdbId#2233101,CommonEquityTier1Ratio#2233102,CounterpartyName#2233103,CountryOfIncorporation#2233104,CountryOfResidence#2233105,Default#2233106,DefaultDate#2233107,DefaultEndDate#2233108,ExemptionFromAdvancedInternalRatingBasedApproach#2233109,FrCounterpartySegmentation#2233110,GlobalCounterpartyIdentifier#2233111,GlobalOrganisationID#2233112,ImmediateParentOrganisation#2233113,ImmediateParentOrganisationIndicator#2233114,... 43 more fields] parquet\n      :  :        :  :  :  +- SubqueryAlias PD_UCR\n      :  :        :  :  :     +- Project [CounterpartyID#2233160, CounterpartySourceSystemIdentifier#2233161, PDModelCode#2233167, LastPerformingPDModelCode#2233168]\n      :  :        :  :  :        +- SubqueryAlias bsrc_d.int_202505.mainbank_pd_ucr_step3\n      :  :        :  :  :           +- Relation bsrc_d.int_202505.mainbank_pd_ucr_step3[DeliveryEntity#2233158,ReportingDate#2233159,CounterpartyID#2233160,CounterpartySourceSystemIdentifier#2233161,BcdbId#2233162,AacAlphaCode#2233163,GlobalCounterpartyIdentifier#2233164,InterCompanyIndicator#2233165,Default#2233166,PDModelCode#2233167,LastPerformingPDModelCode#2233168,ApprovedUniformCounterpartyRating#2233169,UCRStep1#2233170,UCRStep2#2233171,UniformCounterpartyRating#2233172,ProbabilityOfDefaultBeforeConservatism#2233173,ProbabilityOfDefault#2233174,UniformCounterpartyRatingDate#2233175,UniformCounterpartyRatingExpiryDate#2233176,PDMarginOfConservatism#2233177,UCRCase#2233178,RatingSourceCounterpartyID#2233179,RatingSourceCounterpartySourceSystemIdentifier#2233180,fairid#2233181,UniquePDRatingId#2233182,... 1 more fields] parquet\n      :  :        :  :  +- SubqueryAlias IC\n      :  :        :  :     +- Project [CounterpartyID#2233206, CounterpartySourceSystemIdentifier#2233207, InterCompanyFlag#2233210]\n      :  :        :  :        +- SubqueryAlias bsrc_d.int_202505.mainbank_intercompany\n      :  :        :  :           +- Relation bsrc_d.int_202505.mainbank_intercompany[DeliveryEntity#2233205,CounterpartyID#2233206,CounterpartySourceSystemIdentifier#2233207,InsighterId#2233208,GlobalCounterpartyIdentifier#2233209,InterCompanyFlag#2233210,CounterpartyName#2233211,BaselCounterpartyType#2233212,CountryOfIncorporation#2233213,RealCompanyActivitySector#2233214,UltimateParent#2233215,ReportingEntity#2233216,InterCompanyType#2233217] parquet\n      :  :        :  +- SubqueryAlias LGD\n      :  :        :     +- Project [CreditFacilityID#2233221, CreditFacilitySourceSystemIdentifier#2233222, CounterpartyID#2233224, CounterpartySourceSystemIdentifier#2233225, LGDModelCode#2233229]\n      :  :        :        +- SubqueryAlias bsrc_d.int_202505.mainbank_lgd\n      :  :        :           +- Relation bsrc_d.int_202505.mainbank_lgd[DeliveryEntity#2233218,ReportingDate#2233219,ReportingEntity#2233220,CreditFacilityID#2233221,CreditFacilitySourceSystemIdentifier#2233222,GlobalFacilityIdentifier#2233223,CounterpartyID#2233224,CounterpartySourceSystemIdentifier#2233225,BaselCounterpartyType#2233226,ProbabilityOfDefaultModel#2233227,PlNplIndicator#2233228,LGDModelCode#2233229,LGDSubModelCode#2233230,LGDClass#2233231,DownturnLossGivenDefault#2233232,ThroughTheCycleLossGivenDefault#2233233,LossGivenDefaultRatingApprovalDate#2233234,LossGivenDefaultExpiryDate#2233235,LGDMarginOfConservatism#2233236,LGDType#2233237,LGDSource#2233238] parquet\n      :  :        +- SubqueryAlias `1286EXMP`\n      :  :           +- Project [EXEMPTION_CONDITION_ID#2233239, EXEMPTION_ID#2233240, EXEMPTION_NAME#2233241, EXEMPTION_END_DATE#2233242, SOURCE_SYS_COMP_ID#2233243, PD_RTG_MODEL#2233244, REPORTING_ENTITY_ID#2233245, B2_PD_TYPE_ID#2233246, RPRT_CAR_ACCCODE_ID#2233247, B2_CPTY_TYPE_ID#2233248, CR_PD_PROGRAM#2233249, CUSTOMER_MARKET_SEGMENT_ID#2233250, LGD_RTG_MODEL#2233251, LEGAL_ENTITY#2233252, EX_FBN_FLAG#2233253, INTERCOMPANY_FLAG#2233254, CTPTY_UID#2233255, CTPTY_SSC#2233256, BASEL_APPROACH#2233257, EC_MODEL_INPUT_INDICATOR#2233258, EC_PROXIED_INDICATOR#2233259, TIME_STAMP#2233260, MIN_TURNOVER#2233261, SOURCED_EXEMPTION_ID#2233262, PL_NPL_INDICATOR#2233263, ... 1 more fields]\n      :  :              +- SubqueryAlias bsrc_d.stg_202505.bsl_andes_1286_b2_exmp_cond\n      :  :                 +- Relation bsrc_d.stg_202505.bsl_andes_1286_b2_exmp_cond[EXEMPTION_CONDITION_ID#2233239,EXEMPTION_ID#2233240,EXEMPTION_NAME#2233241,EXEMPTION_END_DATE#2233242,SOURCE_SYS_COMP_ID#2233243,PD_RTG_MODEL#2233244,REPORTING_ENTITY_ID#2233245,B2_PD_TYPE_ID#2233246,RPRT_CAR_ACCCODE_ID#2233247,B2_CPTY_TYPE_ID#2233248,CR_PD_PROGRAM#2233249,CUSTOMER_MARKET_SEGMENT_ID#2233250,LGD_RTG_MODEL#2233251,LEGAL_ENTITY#2233252,EX_FBN_FLAG#2233253,INTERCOMPANY_FLAG#2233254,CTPTY_UID#2233255,CTPTY_SSC#2233256,BASEL_APPROACH#2233257,EC_MODEL_INPUT_INDICATOR#2233258,EC_PROXIED_INDICATOR#2233259,TIME_STAMP#2233260,MIN_TURNOVER#2233261,SOURCED_EXEMPTION_ID#2233262,PL_NPL_INDICATOR#2233263,... 1 more fields] parquet\n      :  +- SubqueryAlias INT_CF_LINKS\n      :     +- Project [DeliveryEntity#2233265, ReportingDate#2233266, CounterpartyRole#2233267, CreditFacility#2233268, CreditFacilitySourceSystemIdentifier#2233269, LiabilityPercentage#2233270, ParticipatingCounterparty#2233271, ParticipatingCounterpartySourceSystemIdentifier#2233272]\n      :        +- SubqueryAlias bsrc_d.int_202505.mainbank_integrated_creditfacility_links\n      :           +- Relation bsrc_d.int_202505.mainbank_integrated_creditfacility_links[DeliveryEntity#2233265,ReportingDate#2233266,CounterpartyRole#2233267,CreditFacility#2233268,CreditFacilitySourceSystemIdentifier#2233269,LiabilityPercentage#2233270,ParticipatingCounterparty#2233271,ParticipatingCounterpartySourceSystemIdentifier#2233272] parquet\n      +- SubqueryAlias EXMP_CP_RC\n         +- Project [DeliveryEntity#2233273, ReportingDate#2233274, CounterpartyID#2233275, CounterpartySourceSystemIdentifier#2233276, GlobalCounterpartyIdentifier#2233277, SourcedExemptionId#2233278, PDModelCode#2233279, LastPerformingPDModelCode#2233280, IntercompanyFlag#2233281, BaselCreditRiskApproach#2233282, ExemptionConditionIdRC#2233283, ExemptionIdRC#2233284, ExemptionNameRC#2233285, ExemptionTypeRC#2233286]\n            +- SubqueryAlias bsrc_d.enrich_202505.mainbank_exemptionclaim_counterparty_rc\n               +- Relation bsrc_d.enrich_202505.mainbank_exemptionclaim_counterparty_rc[DeliveryEntity#2233273,ReportingDate#2233274,CounterpartyID#2233275,CounterpartySourceSystemIdentifier#2233276,GlobalCounterpartyIdentifier#2233277,SourcedExemptionId#2233278,PDModelCode#2233279,LastPerformingPDModelCode#2233280,IntercompanyFlag#2233281,BaselCreditRiskApproach#2233282,ExemptionConditionIdRC#2233283,ExemptionIdRC#2233284,ExemptionNameRC#2233285,ExemptionTypeRC#2233286] parquet\n\n\nJVM stacktrace:\norg.apache.spark.sql.catalyst.ExtendedAnalysisException\n\tat org.apache.spark.sql.errors.QueryCompilationErrors$.unresolvedAttributeError(QueryCompilationErrors.scala:504)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.org$apache$spark$sql$catalyst$analysis$CheckAnalysis$$failUnresolvedAttribute(CheckAnalysis.scala:179)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$10(CheckAnalysis.scala:489)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$10$adapted(CheckAnalysis.scala:474)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:303)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)\n\tat scala.collection.immutable.List.foreach(List.scala:333)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)\n\tat scala.collection.immutable.Vector.foreach(Vector.scala:1895)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)\n\tat scala.collection.immutable.Vector.foreach(Vector.scala:1895)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$9(CheckAnalysis.scala:474)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$9$adapted(CheckAnalysis.scala:474)\n\tat scala.collection.IterableOnceOps.foreach(IterableOnce.scala:575)\n\tat scala.collection.IterableOnceOps.foreach$(IterableOnce.scala:573)\n\tat scala.collection.AbstractIterable.foreach(Iterable.scala:933)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$2(CheckAnalysis.scala:474)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$2$adapted(CheckAnalysis.scala:307)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:303)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)\n\tat scala.collection.immutable.Vector.foreach(Vector.scala:1895)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)\n\tat scala.collection.immutable.Vector.foreach(Vector.scala:1895)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)\n\tat scala.collection.immutable.Vector.foreach(Vector.scala:1895)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)\n\tat scala.collection.immutable.Vector.foreach(Vector.scala:1895)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.checkAnalysis0(CheckAnalysis.scala:307)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.checkAnalysis0$(CheckAnalysis.scala:278)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer.checkAnalysis0(Analyzer.scala:416)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis$1(CheckAnalysis.scala:263)\n\tat scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.scala:18)\n\tat com.databricks.spark.util.FrameProfiler$.record(FrameProfiler.scala:94)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.checkAnalysis(CheckAnalysis.scala:250)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.checkAnalysis$(CheckAnalysis.scala:250)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer.checkAnalysis(Analyzer.scala:416)\n\tat org.apache.spark.sql.catalyst.analysis.resolver.HybridAnalyzer.$anonfun$resolveInFixedPoint$1(HybridAnalyzer.scala:254)\n\tat scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.scala:18)\n\tat org.apache.spark.sql.catalyst.QueryPlanningTracker$.withTracker(QueryPlanningTracker.scala:219)\n\tat org.apache.spark.sql.catalyst.analysis.resolver.HybridAnalyzer.resolveInFixedPoint(HybridAnalyzer.scala:254)\n\tat org.apache.spark.sql.catalyst.analysis.resolver.HybridAnalyzer.$anonfun$apply$1(HybridAnalyzer.scala:96)\n\tat org.apache.spark.sql.catalyst.analysis.resolver.HybridAnalyzer.withTrackedAnalyzerBridgeState(HybridAnalyzer.scala:131)\n\tat org.apache.spark.sql.catalyst.analysis.resolver.HybridAnalyzer.apply(HybridAnalyzer.scala:87)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer.$anonfun$executeAndCheck$1(Analyzer.scala:478)\n\tat org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper$.markInAnalyzer(AnalysisHelper.scala:425)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer.executeAndCheck(Analyzer.scala:478)\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$lazyAnalyzed$3(QueryExecution.scala:294)\n\tat com.databricks.spark.util.FrameProfiler$.record(FrameProfiler.scala:94)\n\tat org.apache.spark.sql.catalyst.QueryPlanningTracker.measurePhase(QueryPlanningTracker.scala:548)\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$5(QueryExecution.scala:668)\n\tat org.apache.spark.sql.execution.SQLExecution$.withExecutionPhase(SQLExecution.scala:151)\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$4(QueryExecution.scala:668)\n\tat org.apache.spark.sql.execution.QueryExecution$.withInternalError(QueryExecution.scala:1307)\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$2(QueryExecution.scala:661)\n\tat com.databricks.util.LexicalThreadLocal$Handle.runWith(LexicalThreadLocal.scala:63)\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$1(QueryExecution.scala:658)\n\tat org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:1462)\n\tat org.apache.spark.sql.execution.QueryExecution.executePhase(QueryExecution.scala:658)\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$lazyAnalyzed$2(QueryExecution.scala:288)\n\tat com.databricks.sql.util.MemoryTrackerHelper.withMemoryTracking(MemoryTrackerHelper.scala:80)\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$lazyAnalyzed$1(QueryExecution.scala:287)\n\tat scala.util.Try$.apply(Try.scala:210)\n\tat org.apache.spark.util.Utils$.doTryWithCallerStacktrace(Utils.scala:1684)\n\tat org.apache.spark.util.Utils$.getTryWithCallerStacktrace(Utils.scala:1745)\n\tat org.apache.spark.util.LazyTry.get(LazyTry.scala:58)\n\tat org.apache.spark.sql.execution.QueryExecution.analyzed(QueryExecution.scala:321)\n\tat org.apache.spark.sql.execution.QueryExecution.assertAnalyzed(QueryExecution.scala:267)\n\tat org.apache.spark.sql.Dataset$.$anonfun$ofRows$1(Dataset.scala:108)\n\tat org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:1462)\n\tat org.apache.spark.sql.SparkSession.$anonfun$withActiveAndFrameProfiler$1(SparkSession.scala:1469)\n\tat com.databricks.spark.util.FrameProfiler$.record(FrameProfiler.scala:94)\n\tat org.apache.spark.sql.SparkSession.withActiveAndFrameProfiler(SparkSession.scala:1469)\n\tat org.apache.spark.sql.Dataset$.ofRows(Dataset.scala:106)\n\tat org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.process(SparkConnectAnalyzeHandler.scala:137)\n\tat org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.$anonfun$handle$3(SparkConnectAnalyzeHandler.scala:104)\n\tat org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.$anonfun$handle$3$adapted(SparkConnectAnalyzeHandler.scala:66)\n\tat org.apache.spark.sql.connect.service.SessionHolder.$anonfun$withSession$2(SessionHolder.scala:464)\n\tat org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:1462)\n\tat org.apache.spark.sql.connect.service.SessionHolder.$anonfun$withSession$1(SessionHolder.scala:464)\n\tat org.apache.spark.JobArtifactSet$.withActiveJobArtifactState(JobArtifactSet.scala:97)\n\tat org.apache.spark.sql.artifact.ArtifactManager.$anonfun$withResources$1(ArtifactManager.scala:90)\n\tat org.apache.spark.util.Utils$.withContextClassLoader(Utils.scala:241)\n\tat org.apache.spark.sql.artifact.ArtifactManager.withResources(ArtifactManager.scala:89)\n\tat org.apache.spark.sql.connect.service.SessionHolder.withSession(SessionHolder.scala:463)\n\tat org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.$anonfun$handle$1(SparkConnectAnalyzeHandler.scala:66)\n\tat org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.$anonfun$handle$1$adapted(SparkConnectAnalyzeHandler.scala:51)\n\tat com.databricks.spark.connect.logging.rpc.SparkConnectRpcMetricsCollectorUtils$.collectMetrics(SparkConnectRpcMetricsCollector.scala:258)\n\tat org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.handle(SparkConnectAnalyzeHandler.scala:50)\n\tat org.apache.spark.sql.connect.service.SparkConnectService.analyzePlan(SparkConnectService.scala:109)\n\tat org.apache.spark.connect.proto.SparkConnectServiceGrpc$MethodHandlers.invoke(SparkConnectServiceGrpc.java:801)\n\tat grpc_shaded.io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)\n\tat grpc_shaded.io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)\n\tat grpc_shaded.io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)\n\tat grpc_shaded.io.grpc.ForwardingServerCallListener$SimpleForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:40)\n\tat grpc_shaded.io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)\n\tat grpc_shaded.io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)\n\tat grpc_shaded.io.grpc.ForwardingServerCallListener$SimpleForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:40)\n\tat com.databricks.spark.connect.service.AuthenticationInterceptor$AuthenticatedServerCallListener.$anonfun$onHalfClose$1(AuthenticationInterceptor.scala:381)\n\tat scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.scala:18)\n\tat com.databricks.unity.UCSEphemeralState$Handle.runWith(UCSEphemeralState.scala:51)\n\tat com.databricks.unity.HandleImpl.runWith(UCSHandle.scala:104)\n\tat com.databricks.spark.connect.service.RequestContext.$anonfun$runWith$3(RequestContext.scala:337)\n\tat com.databricks.spark.connect.service.RequestContext$.com$databricks$spark$connect$service$RequestContext$$withLocalProperties(RequestContext.scala:537)\n\tat com.databricks.spark.connect.service.RequestContext.$anonfun$runWith$2(RequestContext.scala:337)\n\tat com.databricks.logging.AttributionContextTracing.$anonfun$withAttributionContext$1(AttributionContextTracing.scala:49)\n\tat com.databricks.logging.AttributionContext$.$anonfun$withValue$1(AttributionContext.scala:293)\n\tat scala.util.DynamicVariable.withValue(DynamicVariable.scala:59)\n\tat com.databricks.logging.AttributionContext$.withValue(AttributionContext.scala:289)\n\tat com.databricks.logging.AttributionContextTracing.withAttributionContext(AttributionContextTracing.scala:47)\n\tat com.databricks.logging.AttributionContextTracing.withAttributionContext$(AttributionContextTracing.scala:44)\n\tat com.databricks.spark.util.PublicDBLogging.withAttributionContext(DatabricksSparkUsageLogger.scala:30)\n\tat com.databricks.spark.util.UniverseAttributionContextWrapper.withValue(AttributionContextUtils.scala:242)\n\tat com.databricks.spark.connect.service.RequestContext.$anonfun$runWith$1(RequestContext.scala:336)\n\tat com.databricks.spark.connect.service.RequestContext.withContext(RequestContext.scala:349)\n\tat com.databricks.spark.connect.service.RequestContext.runWith(RequestContext.scala:329)\n\tat com.databricks.spark.connect.service.AuthenticationInterceptor$AuthenticatedServerCallListener.onHalfClose(AuthenticationInterceptor.scala:381)\n\tat grpc_shaded.io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:351)\n\tat grpc_shaded.io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:861)\n\tat grpc_shaded.io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)\n\tat grpc_shaded.io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)\n\tat org.apache.spark.util.threads.SparkThreadLocalCapturingRunnable.$anonfun$run$1(SparkThreadLocalForwardingThreadPoolExecutor.scala:165)\n\tat scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.scala:18)\n\tat com.databricks.util.LexicalThreadLocal$Handle.runWith(LexicalThreadLocal.scala:63)\n\tat org.apache.spark.util.threads.SparkThreadLocalCapturingHelper.$anonfun$runWithCaptured$6(SparkThreadLocalForwardingThreadPoolExecutor.scala:119)\n\tat com.databricks.sql.transaction.tahoe.mst.MSTThreadHelper$.runWithMstTxnId(MSTThreadHelper.scala:57)\n\tat org.apache.spark.util.threads.SparkThreadLocalCapturingHelper.$anonfun$runWithCaptured$5(SparkThreadLocalForwardingThreadPoolExecutor.scala:118)\n\tat com.databricks.spark.util.IdentityClaim$.withClaim(IdentityClaim.scala:48)\n\tat org.apache.spark.util.threads.SparkThreadLocalCapturingHelper.$anonfun$runWithCaptured$4(SparkThreadLocalForwardingThreadPoolExecutor.scala:117)\n\tat com.databricks.unity.UCSEphemeralState$Handle.runWith(UCSEphemeralState.scala:51)\n\tat org.apache.spark.util.threads.SparkThreadLocalCapturingHelper.runWithCaptured(SparkThreadLocalForwardingThreadPoolExecutor.scala:116)\n\tat org.apache.spark.util.threads.SparkThreadLocalCapturingHelper.runWithCaptured$(SparkThreadLocalForwardingThreadPoolExecutor.scala:93)\n\tat org.apache.spark.util.threads.SparkThreadLocalCapturingRunnable.runWithCaptured(SparkThreadLocalForwardingThreadPoolExecutor.scala:162)\n\tat org.apache.spark.util.threads.SparkThreadLocalCapturingRunnable.run(SparkThreadLocalForwardingThreadPoolExecutor.scala:165)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat java.lang.Thread.run(Thread.java:840)", "context": {"errorClass": "UNRESOLVED_COLUMN.WITH_SUGGESTION"}, "exception": {"class": "_InactiveRpcError", "msg": "<_InactiveRpcError of RPC that terminated with:\n\tstatus = StatusCode.INTERNAL\n\tdetails = \"[UNRESOLVED_COLUMN.WITH_SUGGESTION] A column, variable, or function parameter with name `CF`.`LocalFacilityIdentifier` cannot be resolved. Did you mean one of the following? [`EXMP_FAC_RC`.`LocalFacilityIdentifier`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`LocalId`, `EXMP_FAC_RC`.`PDModelCode`]. SQLSTATE: 42703; line 1 pos 59;\n'Project [*, 'min('EXMP_CP_RC_JOINED.ExemptionConditionIdRC) windowspecdefinition('EXMP_FAC_RC.LocalFacilityIdentifier, unspecifiedframe$()) AS var_lowest_ExemptionClaimConditonID_CP_RC#2232730]\n+- 'SubqueryAlias EXMP_CP_RC_JOINED\n   +- 'Join LeftOuter, 'and(('INT_CF_LINKS.ParticipatingCounterparty = 'EXMP_CP_RC.CounterpartyID), ('INT_CF_LINKS.ParticipatingCounterpartySourceSystemIdentifier = 'EXMP_CP_RC.CounterpartySourceSystemIdentifier))\n      :- 'Join LeftOuter, 'and(('CF.LocalFacilityIdentifier = 'INT_CF_LINKS.CreditFacility), ('CF.SourceSystemIdentifier = 'INT_CF_LINKS.CreditFacilitySourceSystemIdentifier))\n      :  :- 'Project [DeliveryEntity#2232988, ReportingDate#2232989, ReportingEntity#2233067, LocalFacilityIdentifier#2232990, SourceSystemIdentifier#2233070, CounterpartyID#2233088, CounterpartySourceSystemIdentifier#2233089, BaselIIProductType#2233005, PlNplIndicator#2233063, ProductProgram#2233065, SpecialisedLendingType#2233071, ExemptionFromAdvancedInternalRatingBasedApproach#2233031, SubFacilityFlag#2233087, DeliveryEntity#2233090, ReportingDate#2233091, LocalId#2233118, SourceSystemIdentifier#2233141, GlobalCounterpartyIdentifier#2233111, BaselIICounterpartyType#2233100, ExemptionFromAdvancedInternalRatingBasedApproach#2233109, CounterpartyID#2233160, CounterpartySourceSystemIdentifier#2233161, PDModelCode#2233167, LastPerformingPDModelCode#2233168, CounterpartyID#2233206, ... 34 more fields]\n      :  :  +- SubqueryAlias EXMP_FAC_RC\n      :  :     +- Join LeftOuter, ((((((((((((reporting_entity_id#2233245 = ReportingEntity#2233067) OR (reporting_entity_id#2233245 = *)) AND ((b2_pd_type_id#2233246 = BaselIIProductType#2233005) OR (b2_p...\"\n\tdebug_error_string = \"UNKNOWN:Error received from peer  {created_time:\"2025-08-12T12:26:05.361934597+00:00\", grpc_status:13, grpc_message:\"[UNRESOLVED_COLUMN.WITH_SUGGESTION] A column, variable, or function parameter with name `CF`.`LocalFacilityIdentifier` cannot be resolved. Did you mean one of the following? [`EXMP_FAC_RC`.`LocalFacilityIdentifier`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`LocalId`, `EXMP_FAC_RC`.`PDModelCode`]. SQLSTATE: 42703; line 1 pos 59;\\n\\'Project [*, \\'min(\\'EXMP_CP_RC_JOINED.ExemptionConditionIdRC) windowspecdefinition(\\'EXMP_FAC_RC.LocalFacilityIdentifier, unspecifiedframe$()) AS var_lowest_ExemptionClaimConditonID_CP_RC#2232730]\\n+- \\'SubqueryAlias EXMP_CP_RC_JOINED\\n   +- \\'Join LeftOuter, \\'and((\\'INT_CF_LINKS.ParticipatingCounterparty = \\'EXMP_CP_RC.CounterpartyID), (\\'INT_CF_LINKS.ParticipatingCounterpartySourceSystemIdentifier = \\'EXMP_CP_RC.CounterpartySourceSystemIdentifier))\\n      :- \\'Join LeftOuter, \\'and((\\'CF.LocalFacilityIdentifier = \\'INT_CF_LINKS.CreditFacility), (\\'CF.SourceSystemIdentifier = \\'INT_CF_LINKS.CreditFacilitySourceSystemIdentifier))\\n      :  :- \\'Project [DeliveryEntity#2232988, ReportingDate#2232989, ReportingEntity#2233067, LocalFacilityIdentifier#2232990, SourceSystemIdentifier#2233070, CounterpartyID#2233088, CounterpartySourceSystemIdentifier#2233089, BaselIIProductType#2233005, PlNplIndicator#2233063, ProductProgram#2233065, SpecialisedLendingType#2233071, ExemptionFromAdvancedInternalRatingBasedApproach#2233031, SubFacilityFlag#2233087, DeliveryEntity#2233090, ReportingDate#2233091, LocalId#2233118, SourceSystemIdentifier#2233141, GlobalCounterpartyIdentifier#2233111, BaselIICounterpartyType#2233100, ExemptionFromAdvancedInternalRatingBasedApproach#2233109, CounterpartyID#2233160, CounterpartySourceSystemIdentifier#2233161, PDModelCode#2233167, LastPerformingPDModelCode#2233168, CounterpartyID#2233206, ... 34 more fields]\\n      :  :  +- SubqueryAlias EXMP_FAC_RC\\n      :  :     +- Join LeftOuter, ((((((((((((reporting_entity_id#2233245 = ReportingEntity#2233067) OR (reporting_entity_id#2233245 = *)) AND ((b2_pd_type_id#2233246 = BaselIIProductType#2233005) OR (b2_p...\"}\"\n>", "stacktrace": [{"class": null, "method": "_analyze", "file": "/databricks/spark/python/pyspark/sql/connect/client/core.py", "line": "1736"}, {"class": null, "method": "__call__", "file": "/databricks/python/lib/python3.12/site-packages/grpc/_interceptor.py", "line": "277"}, {"class": null, "method": "_with_call", "file": "/databricks/python/lib/python3.12/site-packages/grpc/_interceptor.py", "line": "332"}, {"class": null, "method": "result", "file": "/databricks/python/lib/python3.12/site-packages/grpc/_channel.py", "line": "437"}, {"class": null, "method": "continuation", "file": "/databricks/python/lib/python3.12/site-packages/grpc/_interceptor.py", "line": "315"}, {"class": null, "method": "with_call", "file": "/databricks/python/lib/python3.12/site-packages/grpc/_channel.py", "line": "1177"}, {"class": null, "method": "_end_unary_response_blocking", "file": "/databricks/python/lib/python3.12/site-packages/grpc/_channel.py", "line": "1003"}]}}
2025-08-12 12:26:05 [ERROR] _log:  [UNRESOLVED_COLUMN.WITH_SUGGESTION] A column, variable, or function parameter with name `CF`.`LocalFacilityIdentifier` cannot be resolved. Did you mean one of the following? [`EXMP_FAC_RC`.`LocalFacilityIdentifier`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`LocalId`, `EXMP_FAC_RC`.`PDModelCode`]. SQLSTATE: 42703; line 1 pos 59;
'Project [*, 'min('EXMP_CP_RC_JOINED.ExemptionConditionIdRC) windowspecdefinition('EXMP_FAC_RC.LocalFacilityIdentifier, unspecifiedframe$()) AS var_lowest_ExemptionClaimConditonID_CP_RC#2232730]
+- 'SubqueryAlias EXMP_CP_RC_JOINED
   +- 'Join LeftOuter, 'and(('INT_CF_LINKS.ParticipatingCounterparty = 'EXMP_CP_RC.CounterpartyID), ('INT_CF_LINKS.ParticipatingCounterpartySourceSystemIdentifier = 'EXMP_CP_RC.CounterpartySourceSystemIdentifier))
      :- 'Join LeftOuter, 'and(('CF.LocalFacilityIdentifier = 'INT_CF_LINKS.CreditFacility), ('CF.SourceSystemIdentifier = 'INT_CF_LINKS.CreditFacilitySourceSystemIdentifier))
      :  :- 'Project [DeliveryEntity#2232988, ReportingDate#2232989, ReportingEntity#2233067, LocalFacilityIdentifier#2232990, SourceSystemIdentifier#2233070, CounterpartyID#2233088, CounterpartySourceSystemIdentifier#2233089, BaselIIProductType#2233005, PlNplIndicator#2233063, ProductProgram#2233065, SpecialisedLendingType#2233071, ExemptionFromAdvancedInternalRatingBasedApproach#2233031, SubFacilityFlag#2233087, DeliveryEntity#2233090, ReportingDate#2233091, LocalId#2233118, SourceSystemIdentifier#2233141, GlobalCounterpartyIdentifier#2233111, BaselIICounterpartyType#2233100, ExemptionFromAdvancedInternalRatingBasedApproach#2233109, CounterpartyID#2233160, CounterpartySourceSystemIdentifier#2233161, PDModelCode#2233167, LastPerformingPDModelCode#2233168, CounterpartyID#2233206, ... 34 more fields]
      :  :  +- SubqueryAlias EXMP_FAC_RC
      :  :     +- Join LeftOuter, ((((((((((((reporting_entity_id#2233245 = ReportingEntity#2233067) OR (reporting_entity_id#2233245 = *)) AND ((b2_pd_type_id#2233246 = BaselIIProductType#2233005) OR (b2_pd_type_id#2233246 = *))) AND ((lgd_rtg_model#2233251 = LGDModelCode#2233229) OR (lgd_rtg_model#2233251 = *))) AND ((pl_npl_indicator#2233263 = PlNplIndicator#2233063) OR (pl_npl_indicator#2233263 = *))) AND ((specialised_lending_type#2233264 = SpecialisedLendingType#2233071) OR (specialised_lending_type#2233264 = *))) AND ((cr_pd_program#2233249 = ProductProgram#2233065) OR (cr_pd_program#2233249 = *))) AND (((pd_rtg_model#2233244 = PDModelCode#2233167) OR (pd_rtg_model#2233244 = LastPerformingPDModelCode#2233168)) OR (pd_rtg_model#2233244 = *))) AND ((b2_cpty_type_id#2233248 = BaselIICounterpartyType#2233100) OR (b2_cpty_type_id#2233248 = *))) AND (((intercompany_flag#2233254 = InterCompanyFlag#2233210) = cast(Y as boolean)) OR (intercompany_flag#2233254 = *))) AND ((upper(sourced_exemption_id#2233262) = upper(coalesce(ExemptionFromAdvancedInternalRatingBasedApproach#2233031, ExemptionFromAdvancedInternalRatingBasedApproach#2233109))) OR (sourced_exemption_id#2233262 = *))) AND (((concat(ctpty_ssc#2233256, ctpty_uid#2233255) = LocalId#2233118) OR ((ctpty_ssc#2233256 = EPR) AND (ltrim(ctpty_uid#2233255, Some(0)) = ltrim(GlobalCounterpartyIdentifier#2233111, Some(0))))) OR (ctpty_uid#2233255 = *)))
      :  :        :- Join LeftOuter, ((LocalFacilityIdentifier#2232990 = CreditFacilityID#2233221) AND (SourceSystemIdentifier#2233070 = CreditFacilitySourceSystemIdentifier#2233222))
      :  :        :  :- Join LeftOuter, ((CounterpartyID#2233088 = CounterpartyID#2233206) AND (CounterpartySourceSystemIdentifier#2233089 = CounterpartySourceSystemIdentifier#2233207))
      :  :        :  :  :- Join LeftOuter, ((CounterpartyID#2233088 = CounterpartyID#2233160) AND (CounterpartySourceSystemIdentifier#2233089 = CounterpartySourceSystemIdentifier#2233161))
      :  :        :  :  :  :- Join LeftOuter, ((CounterpartyID#2233088 = LocalId#2233118) AND (CounterpartySourceSystemIdentifier#2233089 = SourceSystemIdentifier#2233141))
      :  :        :  :  :  :  :- SubqueryAlias CF
      :  :        :  :  :  :  :  +- Project [DeliveryEntity#2232988, ReportingDate#2232989, ReportingEntity#2233067, LocalFacilityIdentifier#2232990, SourceSystemIdentifier#2233070, CounterpartyID#2233088, CounterpartySourceSystemIdentifier#2233089, BaselIIProductType#2233005, PlNplIndicator#2233063, ProductProgram#2233065, SpecialisedLendingType#2233071, ExemptionFromAdvancedInternalRatingBasedApproach#2233031, SubFacilityFlag#2233087]
      :  :        :  :  :  :  :     +- Filter (SubFacilityFlag#2233087 = N)
      :  :        :  :  :  :  :        +- SubqueryAlias bsrc_d.int_202505.mainbank_integrated_creditfacility
      :  :        :  :  :  :  :           +- Relation bsrc_d.int_202505.mainbank_integrated_creditfacility[DeliveryEntity#2232988,ReportingDate#2232989,LocalFacilityIdentifier#2232990,Default#2232991,DefaultDate#2232992,DefaultEndDate#2232993,NonperformingEndDate#2232994,NonperformingStartDate#2232995,PerformingIndicator#2232996,AccruedFeesAmountDebitCreditIndicator#2232997,AccruedFeesAmountReportingAmount#2232998,AccruedFeesAmountReportingCurrency#2232999,AccruedFeesAmountTransactionAmount#2233000,AccruedFeesAmountTransactionCurrency#2233001,AlternativeLocalReferenceIdentifier#2233002,ApprovedLossGivenDefaultRatingDate#2233003,ArrangementParticipationType#2233004,BaselIIProductType#2233005,BookType#2233006,BorrowingBaseReportingAmount#2233007,BorrowingBaseReportingCurrency#2233008,BorrowingBaseTransactionAmount#2233009,BorrowingBaseTransactionCurrency#2233010,BusinessSegment#2233011,ContractStatus#2233012,... 77 more fields] parquet
      :  :        :  :  :  :  +- SubqueryAlias INT_CP
      :  :        :  :  :  :     +- Project [DeliveryEntity#2233090, ReportingDate#2233091, LocalId#2233118, SourceSystemIdentifier#2233141, GlobalCounterpartyIdentifier#2233111, BaselIICounterpartyType#2233100, ExemptionFromAdvancedInternalRatingBasedApproach#2233109]
      :  :        :  :  :  :        +- SubqueryAlias bsrc_d.int_202505.mainbank_integrated_counterparty
      :  :        :  :  :  :           +- Relation bsrc_d.int_202505.mainbank_integrated_counterparty[DeliveryEntity#2233090,ReportingDate#2233091,AacAlphaCode#2233092,AlternativeLocalReferenceIdentifier#2233093,AnnualTurnoverReportingAmount#2233094,AnnualTurnoverReportingCurrency#2233095,AnnualTurnoverTransactionAmount#2233096,AnnualTurnoverTransactionCurrency#2233097,ApprovedUniformCounterpartyRating#2233098,ApprovedUniformCounterpartyRatingExpirationDate#2233099,BaselIICounterpartyType#2233100,BcdbId#2233101,CommonEquityTier1Ratio#2233102,CounterpartyName#2233103,CountryOfIncorporation#2233104,CountryOfResidence#2233105,Default#2233106,DefaultDate#2233107,DefaultEndDate#2233108,ExemptionFromAdvancedInternalRatingBasedApproach#2233109,FrCounterpartySegmentation#2233110,GlobalCounterpartyIdentifier#2233111,GlobalOrganisationID#2233112,ImmediateParentOrganisation#2233113,ImmediateParentOrganisationIndicator#2233114,... 43 more fields] parquet
      :  :        :  :  :  +- SubqueryAlias PD_UCR
      :  :        :  :  :     +- Project [CounterpartyID#2233160, CounterpartySourceSystemIdentifier#2233161, PDModelCode#2233167, LastPerformingPDModelCode#2233168]
      :  :        :  :  :        +- SubqueryAlias bsrc_d.int_202505.mainbank_pd_ucr_step3
      :  :        :  :  :           +- Relation bsrc_d.int_202505.mainbank_pd_ucr_step3[DeliveryEntity#2233158,ReportingDate#2233159,CounterpartyID#2233160,CounterpartySourceSystemIdentifier#2233161,BcdbId#2233162,AacAlphaCode#2233163,GlobalCounterpartyIdentifier#2233164,InterCompanyIndicator#2233165,Default#2233166,PDModelCode#2233167,LastPerformingPDModelCode#2233168,ApprovedUniformCounterpartyRating#2233169,UCRStep1#2233170,UCRStep2#2233171,UniformCounterpartyRating#2233172,ProbabilityOfDefaultBeforeConservatism#2233173,ProbabilityOfDefault#2233174,UniformCounterpartyRatingDate#2233175,UniformCounterpartyRatingExpiryDate#2233176,PDMarginOfConservatism#2233177,UCRCase#2233178,RatingSourceCounterpartyID#2233179,RatingSourceCounterpartySourceSystemIdentifier#2233180,fairid#2233181,UniquePDRatingId#2233182,... 1 more fields] parquet
      :  :        :  :  +- SubqueryAlias IC
      :  :        :  :     +- Project [CounterpartyID#2233206, CounterpartySourceSystemIdentifier#2233207, InterCompanyFlag#2233210]
      :  :        :  :        +- SubqueryAlias bsrc_d.int_202505.mainbank_intercompany
      :  :        :  :           +- Relation bsrc_d.int_202505.mainbank_intercompany[DeliveryEntity#2233205,CounterpartyID#2233206,CounterpartySourceSystemIdentifier#2233207,InsighterId#2233208,GlobalCounterpartyIdentifier#2233209,InterCompanyFlag#2233210,CounterpartyName#2233211,BaselCounterpartyType#2233212,CountryOfIncorporation#2233213,RealCompanyActivitySector#2233214,UltimateParent#2233215,ReportingEntity#2233216,InterCompanyType#2233217] parquet
      :  :        :  +- SubqueryAlias LGD
      :  :        :     +- Project [CreditFacilityID#2233221, CreditFacilitySourceSystemIdentifier#2233222, CounterpartyID#2233224, CounterpartySourceSystemIdentifier#2233225, LGDModelCode#2233229]
      :  :        :        +- SubqueryAlias bsrc_d.int_202505.mainbank_lgd
      :  :        :           +- Relation bsrc_d.int_202505.mainbank_lgd[DeliveryEntity#2233218,ReportingDate#2233219,ReportingEntity#2233220,CreditFacilityID#2233221,CreditFacilitySourceSystemIdentifier#2233222,GlobalFacilityIdentifier#2233223,CounterpartyID#2233224,CounterpartySourceSystemIdentifier#2233225,BaselCounterpartyType#2233226,ProbabilityOfDefaultModel#2233227,PlNplIndicator#2233228,LGDModelCode#2233229,LGDSubModelCode#2233230,LGDClass#2233231,DownturnLossGivenDefault#2233232,ThroughTheCycleLossGivenDefault#2233233,LossGivenDefaultRatingApprovalDate#2233234,LossGivenDefaultExpiryDate#2233235,LGDMarginOfConservatism#2233236,LGDType#2233237,LGDSource#2233238] parquet
      :  :        +- SubqueryAlias `1286EXMP`
      :  :           +- Project [EXEMPTION_CONDITION_ID#2233239, EXEMPTION_ID#2233240, EXEMPTION_NAME#2233241, EXEMPTION_END_DATE#2233242, SOURCE_SYS_COMP_ID#2233243, PD_RTG_MODEL#2233244, REPORTING_ENTITY_ID#2233245, B2_PD_TYPE_ID#2233246, RPRT_CAR_ACCCODE_ID#2233247, B2_CPTY_TYPE_ID#2233248, CR_PD_PROGRAM#2233249, CUSTOMER_MARKET_SEGMENT_ID#2233250, LGD_RTG_MODEL#2233251, LEGAL_ENTITY#2233252, EX_FBN_FLAG#2233253, INTERCOMPANY_FLAG#2233254, CTPTY_UID#2233255, CTPTY_SSC#2233256, BASEL_APPROACH#2233257, EC_MODEL_INPUT_INDICATOR#2233258, EC_PROXIED_INDICATOR#2233259, TIME_STAMP#2233260, MIN_TURNOVER#2233261, SOURCED_EXEMPTION_ID#2233262, PL_NPL_INDICATOR#2233263, ... 1 more fields]
      :  :              +- SubqueryAlias bsrc_d.stg_202505.bsl_andes_1286_b2_exmp_cond
      :  :                 +- Relation bsrc_d.stg_202505.bsl_andes_1286_b2_exmp_cond[EXEMPTION_CONDITION_ID#2233239,EXEMPTION_ID#2233240,EXEMPTION_NAME#2233241,EXEMPTION_END_DATE#2233242,SOURCE_SYS_COMP_ID#2233243,PD_RTG_MODEL#2233244,REPORTING_ENTITY_ID#2233245,B2_PD_TYPE_ID#2233246,RPRT_CAR_ACCCODE_ID#2233247,B2_CPTY_TYPE_ID#2233248,CR_PD_PROGRAM#2233249,CUSTOMER_MARKET_SEGMENT_ID#2233250,LGD_RTG_MODEL#2233251,LEGAL_ENTITY#2233252,EX_FBN_FLAG#2233253,INTERCOMPANY_FLAG#2233254,CTPTY_UID#2233255,CTPTY_SSC#2233256,BASEL_APPROACH#2233257,EC_MODEL_INPUT_INDICATOR#2233258,EC_PROXIED_INDICATOR#2233259,TIME_STAMP#2233260,MIN_TURNOVER#2233261,SOURCED_EXEMPTION_ID#2233262,PL_NPL_INDICATOR#2233263,... 1 more fields] parquet
      :  +- SubqueryAlias INT_CF_LINKS
      :     +- Project [DeliveryEntity#2233265, ReportingDate#2233266, CounterpartyRole#2233267, CreditFacility#2233268, CreditFacilitySourceSystemIdentifier#2233269, LiabilityPercentage#2233270, ParticipatingCounterparty#2233271, ParticipatingCounterpartySourceSystemIdentifier#2233272]
      :        +- SubqueryAlias bsrc_d.int_202505.mainbank_integrated_creditfacility_links
      :           +- Relation bsrc_d.int_202505.mainbank_integrated_creditfacility_links[DeliveryEntity#2233265,ReportingDate#2233266,CounterpartyRole#2233267,CreditFacility#2233268,CreditFacilitySourceSystemIdentifier#2233269,LiabilityPercentage#2233270,ParticipatingCounterparty#2233271,ParticipatingCounterpartySourceSystemIdentifier#2233272] parquet
      +- SubqueryAlias EXMP_CP_RC
         +- Project [DeliveryEntity#2233273, ReportingDate#2233274, CounterpartyID#2233275, CounterpartySourceSystemIdentifier#2233276, GlobalCounterpartyIdentifier#2233277, SourcedExemptionId#2233278, PDModelCode#2233279, LastPerformingPDModelCode#2233280, IntercompanyFlag#2233281, BaselCreditRiskApproach#2233282, ExemptionConditionIdRC#2233283, ExemptionIdRC#2233284, ExemptionNameRC#2233285, ExemptionTypeRC#2233286]
            +- SubqueryAlias bsrc_d.enrich_202505.mainbank_exemptionclaim_counterparty_rc
               +- Relation bsrc_d.enrich_202505.mainbank_exemptionclaim_counterparty_rc[DeliveryEntity#2233273,ReportingDate#2233274,CounterpartyID#2233275,CounterpartySourceSystemIdentifier#2233276,GlobalCounterpartyIdentifier#2233277,SourcedExemptionId#2233278,PDModelCode#2233279,LastPerformingPDModelCode#2233280,IntercompanyFlag#2233281,BaselCreditRiskApproach#2233282,ExemptionConditionIdRC#2233283,ExemptionIdRC#2233284,ExemptionNameRC#2233285,ExemptionTypeRC#2233286] parquet


JVM stacktrace:
org.apache.spark.sql.catalyst.ExtendedAnalysisException
	at org.apache.spark.sql.errors.QueryCompilationErrors$.unresolvedAttributeError(QueryCompilationErrors.scala:504)
	at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.org$apache$spark$sql$catalyst$analysis$CheckAnalysis$$failUnresolvedAttribute(CheckAnalysis.scala:179)
	at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$10(CheckAnalysis.scala:489)
	at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$10$adapted(CheckAnalysis.scala:474)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:303)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)
	at scala.collection.immutable.List.foreach(List.scala:333)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)
	at scala.collection.immutable.Vector.foreach(Vector.scala:1895)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)
	at scala.collection.immutable.Vector.foreach(Vector.scala:1895)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)
	at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$9(CheckAnalysis.scala:474)
	at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$9$adapted(CheckAnalysis.scala:474)
	at scala.collection.IterableOnceOps.foreach(IterableOnce.scala:575)
	at scala.collection.IterableOnceOps.foreach$(IterableOnce.scala:573)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:933)
	at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$2(CheckAnalysis.scala:474)
	at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$2$adapted(CheckAnalysis.scala:307)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:303)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)
	at scala.collection.immutable.Vector.foreach(Vector.scala:1895)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)
	at scala.collection.immutable.Vector.foreach(Vector.scala:1895)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)
	at scala.collection.immutable.Vector.foreach(Vector.scala:1895)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)
	at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)
	at scala.collection.immutable.Vector.foreach(Vector.scala:1895)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)
	at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.checkAnalysis0(CheckAnalysis.scala:307)
	at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.checkAnalysis0$(CheckAnalysis.scala:278)
	at org.apache.spark.sql.catalyst.analysis.Analyzer.checkAnalysis0(Analyzer.scala:416)
	at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis$1(CheckAnalysis.scala:263)
	at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.scala:18)
	at com.databricks.spark.util.FrameProfiler$.record(FrameProfiler.scala:94)
	at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.checkAnalysis(CheckAnalysis.scala:250)
	at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.checkAnalysis$(CheckAnalysis.scala:250)
	at org.apache.spark.sql.catalyst.analysis.Analyzer.checkAnalysis(Analyzer.scala:416)
	at org.apache.spark.sql.catalyst.analysis.resolver.HybridAnalyzer.$anonfun$resolveInFixedPoint$1(HybridAnalyzer.scala:254)
	at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.scala:18)
	at org.apache.spark.sql.catalyst.QueryPlanningTracker$.withTracker(QueryPlanningTracker.scala:219)
	at org.apache.spark.sql.catalyst.analysis.resolver.HybridAnalyzer.resolveInFixedPoint(HybridAnalyzer.scala:254)
	at org.apache.spark.sql.catalyst.analysis.resolver.HybridAnalyzer.$anonfun$apply$1(HybridAnalyzer.scala:96)
	at org.apache.spark.sql.catalyst.analysis.resolver.HybridAnalyzer.withTrackedAnalyzerBridgeState(HybridAnalyzer.scala:131)
	at org.apache.spark.sql.catalyst.analysis.resolver.HybridAnalyzer.apply(HybridAnalyzer.scala:87)
	at org.apache.spark.sql.catalyst.analysis.Analyzer.$anonfun$executeAndCheck$1(Analyzer.scala:478)
	at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper$.markInAnalyzer(AnalysisHelper.scala:425)
	at org.apache.spark.sql.catalyst.analysis.Analyzer.executeAndCheck(Analyzer.scala:478)
	at org.apache.spark.sql.execution.QueryExecution.$anonfun$lazyAnalyzed$3(QueryExecution.scala:294)
	at com.databricks.spark.util.FrameProfiler$.record(FrameProfiler.scala:94)
	at org.apache.spark.sql.catalyst.QueryPlanningTracker.measurePhase(QueryPlanningTracker.scala:548)
	at org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$5(QueryExecution.scala:668)
	at org.apache.spark.sql.execution.SQLExecution$.withExecutionPhase(SQLExecution.scala:151)
	at org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$4(QueryExecution.scala:668)
	at org.apache.spark.sql.execution.QueryExecution$.withInternalError(QueryExecution.scala:1307)
	at org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$2(QueryExecution.scala:661)
	at com.databricks.util.LexicalThreadLocal$Handle.runWith(LexicalThreadLocal.scala:63)
	at org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$1(QueryExecution.scala:658)
	at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:1462)
	at org.apache.spark.sql.execution.QueryExecution.executePhase(QueryExecution.scala:658)
	at org.apache.spark.sql.execution.QueryExecution.$anonfun$lazyAnalyzed$2(QueryExecution.scala:288)
	at com.databricks.sql.util.MemoryTrackerHelper.withMemoryTracking(MemoryTrackerHelper.scala:80)
	at org.apache.spark.sql.execution.QueryExecution.$anonfun$lazyAnalyzed$1(QueryExecution.scala:287)
	at scala.util.Try$.apply(Try.scala:210)
	at org.apache.spark.util.Utils$.doTryWithCallerStacktrace(Utils.scala:1684)
	at org.apache.spark.util.Utils$.getTryWithCallerStacktrace(Utils.scala:1745)
	at org.apache.spark.util.LazyTry.get(LazyTry.scala:58)
	at org.apache.spark.sql.execution.QueryExecution.analyzed(QueryExecution.scala:321)
	at org.apache.spark.sql.execution.QueryExecution.assertAnalyzed(QueryExecution.scala:267)
	at org.apache.spark.sql.Dataset$.$anonfun$ofRows$1(Dataset.scala:108)
	at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:1462)
	at org.apache.spark.sql.SparkSession.$anonfun$withActiveAndFrameProfiler$1(SparkSession.scala:1469)
	at com.databricks.spark.util.FrameProfiler$.record(FrameProfiler.scala:94)
	at org.apache.spark.sql.SparkSession.withActiveAndFrameProfiler(SparkSession.scala:1469)
	at org.apache.spark.sql.Dataset$.ofRows(Dataset.scala:106)
	at org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.process(SparkConnectAnalyzeHandler.scala:137)
	at org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.$anonfun$handle$3(SparkConnectAnalyzeHandler.scala:104)
	at org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.$anonfun$handle$3$adapted(SparkConnectAnalyzeHandler.scala:66)
	at org.apache.spark.sql.connect.service.SessionHolder.$anonfun$withSession$2(SessionHolder.scala:464)
	at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:1462)
	at org.apache.spark.sql.connect.service.SessionHolder.$anonfun$withSession$1(SessionHolder.scala:464)
	at org.apache.spark.JobArtifactSet$.withActiveJobArtifactState(JobArtifactSet.scala:97)
	at org.apache.spark.sql.artifact.ArtifactManager.$anonfun$withResources$1(ArtifactManager.scala:90)
	at org.apache.spark.util.Utils$.withContextClassLoader(Utils.scala:241)
	at org.apache.spark.sql.artifact.ArtifactManager.withResources(ArtifactManager.scala:89)
	at org.apache.spark.sql.connect.service.SessionHolder.withSession(SessionHolder.scala:463)
	at org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.$anonfun$handle$1(SparkConnectAnalyzeHandler.scala:66)
	at org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.$anonfun$handle$1$adapted(SparkConnectAnalyzeHandler.scala:51)
	at com.databricks.spark.connect.logging.rpc.SparkConnectRpcMetricsCollectorUtils$.collectMetrics(SparkConnectRpcMetricsCollector.scala:258)
	at org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.handle(SparkConnectAnalyzeHandler.scala:50)
	at org.apache.spark.sql.connect.service.SparkConnectService.analyzePlan(SparkConnectService.scala:109)
	at org.apache.spark.connect.proto.SparkConnectServiceGrpc$MethodHandlers.invoke(SparkConnectServiceGrpc.java:801)
	at grpc_shaded.io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)
	at grpc_shaded.io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)
	at grpc_shaded.io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)
	at grpc_shaded.io.grpc.ForwardingServerCallListener$SimpleForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:40)
	at grpc_shaded.io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)
	at grpc_shaded.io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)
	at grpc_shaded.io.grpc.ForwardingServerCallListener$SimpleForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:40)
	at com.databricks.spark.connect.service.AuthenticationInterceptor$AuthenticatedServerCallListener.$anonfun$onHalfClose$1(AuthenticationInterceptor.scala:381)
	at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.scala:18)
	at com.databricks.unity.UCSEphemeralState$Handle.runWith(UCSEphemeralState.scala:51)
	at com.databricks.unity.HandleImpl.runWith(UCSHandle.scala:104)
	at com.databricks.spark.connect.service.RequestContext.$anonfun$runWith$3(RequestContext.scala:337)
	at com.databricks.spark.connect.service.RequestContext$.com$databricks$spark$connect$service$RequestContext$$withLocalProperties(RequestContext.scala:537)
	at com.databricks.spark.connect.service.RequestContext.$anonfun$runWith$2(RequestContext.scala:337)
	at com.databricks.logging.AttributionContextTracing.$anonfun$withAttributionContext$1(AttributionContextTracing.scala:49)
	at com.databricks.logging.AttributionContext$.$anonfun$withValue$1(AttributionContext.scala:293)
	at scala.util.DynamicVariable.withValue(DynamicVariable.scala:59)
	at com.databricks.logging.AttributionContext$.withValue(AttributionContext.scala:289)
	at com.databricks.logging.AttributionContextTracing.withAttributionContext(AttributionContextTracing.scala:47)
	at com.databricks.logging.AttributionContextTracing.withAttributionContext$(AttributionContextTracing.scala:44)
	at com.databricks.spark.util.PublicDBLogging.withAttributionContext(DatabricksSparkUsageLogger.scala:30)
	at com.databricks.spark.util.UniverseAttributionContextWrapper.withValue(AttributionContextUtils.scala:242)
	at com.databricks.spark.connect.service.RequestContext.$anonfun$runWith$1(RequestContext.scala:336)
	at com.databricks.spark.connect.service.RequestContext.withContext(RequestContext.scala:349)
	at com.databricks.spark.connect.service.RequestContext.runWith(RequestContext.scala:329)
	at com.databricks.spark.connect.service.AuthenticationInterceptor$AuthenticatedServerCallListener.onHalfClose(AuthenticationInterceptor.scala:381)
	at grpc_shaded.io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:351)
	at grpc_shaded.io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:861)
	at grpc_shaded.io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
	at grpc_shaded.io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)
	at org.apache.spark.util.threads.SparkThreadLocalCapturingRunnable.$anonfun$run$1(SparkThreadLocalForwardingThreadPoolExecutor.scala:165)
	at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.scala:18)
	at com.databricks.util.LexicalThreadLocal$Handle.runWith(LexicalThreadLocal.scala:63)
	at org.apache.spark.util.threads.SparkThreadLocalCapturingHelper.$anonfun$runWithCaptured$6(SparkThreadLocalForwardingThreadPoolExecutor.scala:119)
	at com.databricks.sql.transaction.tahoe.mst.MSTThreadHelper$.runWithMstTxnId(MSTThreadHelper.scala:57)
	at org.apache.spark.util.threads.SparkThreadLocalCapturingHelper.$anonfun$runWithCaptured$5(SparkThreadLocalForwardingThreadPoolExecutor.scala:118)
	at com.databricks.spark.util.IdentityClaim$.withClaim(IdentityClaim.scala:48)
	at org.apache.spark.util.threads.SparkThreadLocalCapturingHelper.$anonfun$runWithCaptured$4(SparkThreadLocalForwardingThreadPoolExecutor.scala:117)
	at com.databricks.unity.UCSEphemeralState$Handle.runWith(UCSEphemeralState.scala:51)
	at org.apache.spark.util.threads.SparkThreadLocalCapturingHelper.runWithCaptured(SparkThreadLocalForwardingThreadPoolExecutor.scala:116)
	at org.apache.spark.util.threads.SparkThreadLocalCapturingHelper.runWithCaptured$(SparkThreadLocalForwardingThreadPoolExecutor.scala:93)
	at org.apache.spark.util.threads.SparkThreadLocalCapturingRunnable.runWithCaptured(SparkThreadLocalForwardingThreadPoolExecutor.scala:162)
	at org.apache.spark.util.threads.SparkThreadLocalCapturingRunnable.run(SparkThreadLocalForwardingThreadPoolExecutor.scala:165)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.lang.Thread.run(Thread.java:840)
Traceback (most recent call last):
  File "/databricks/spark/python/pyspark/sql/connect/client/core.py", line 1736, in _analyze
    resp = self._stub.AnalyzePlan(req, metadata=self.metadata())
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/databricks/python/lib/python3.12/site-packages/grpc/_interceptor.py", line 277, in __call__
    response, ignored_call = self._with_call(
                             ^^^^^^^^^^^^^^^^
  File "/databricks/python/lib/python3.12/site-packages/grpc/_interceptor.py", line 332, in _with_call
    return call.result(), call
           ^^^^^^^^^^^^^
  File "/databricks/python/lib/python3.12/site-packages/grpc/_channel.py", line 437, in result
    raise self
  File "/databricks/python/lib/python3.12/site-packages/grpc/_interceptor.py", line 315, in continuation
    response, call = self._thunk(new_method).with_call(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/databricks/python/lib/python3.12/site-packages/grpc/_channel.py", line 1177, in with_call
    return _end_unary_response_blocking(state, call, True, None)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/databricks/python/lib/python3.12/site-packages/grpc/_channel.py", line 1003, in _end_unary_response_blocking
    raise _InactiveRpcError(state)  # pytype: disable=not-instantiable
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
grpc._channel._InactiveRpcError: <_InactiveRpcError of RPC that terminated with:
	status = StatusCode.INTERNAL
	details = "[UNRESOLVED_COLUMN.WITH_SUGGESTION] A column, variable, or function parameter with name `CF`.`LocalFacilityIdentifier` cannot be resolved. Did you mean one of the following? [`EXMP_FAC_RC`.`LocalFacilityIdentifier`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`LocalId`, `EXMP_FAC_RC`.`PDModelCode`]. SQLSTATE: 42703; line 1 pos 59;
'Project [*, 'min('EXMP_CP_RC_JOINED.ExemptionConditionIdRC) windowspecdefinition('EXMP_FAC_RC.LocalFacilityIdentifier, unspecifiedframe$()) AS var_lowest_ExemptionClaimConditonID_CP_RC#2232730]
+- 'SubqueryAlias EXMP_CP_RC_JOINED
   +- 'Join LeftOuter, 'and(('INT_CF_LINKS.ParticipatingCounterparty = 'EXMP_CP_RC.CounterpartyID), ('INT_CF_LINKS.ParticipatingCounterpartySourceSystemIdentifier = 'EXMP_CP_RC.CounterpartySourceSystemIdentifier))
      :- 'Join LeftOuter, 'and(('CF.LocalFacilityIdentifier = 'INT_CF_LINKS.CreditFacility), ('CF.SourceSystemIdentifier = 'INT_CF_LINKS.CreditFacilitySourceSystemIdentifier))
      :  :- 'Project [DeliveryEntity#2232988, ReportingDate#2232989, ReportingEntity#2233067, LocalFacilityIdentifier#2232990, SourceSystemIdentifier#2233070, CounterpartyID#2233088, CounterpartySourceSystemIdentifier#2233089, BaselIIProductType#2233005, PlNplIndicator#2233063, ProductProgram#2233065, SpecialisedLendingType#2233071, ExemptionFromAdvancedInternalRatingBasedApproach#2233031, SubFacilityFlag#2233087, DeliveryEntity#2233090, ReportingDate#2233091, LocalId#2233118, SourceSystemIdentifier#2233141, GlobalCounterpartyIdentifier#2233111, BaselIICounterpartyType#2233100, ExemptionFromAdvancedInternalRatingBasedApproach#2233109, CounterpartyID#2233160, CounterpartySourceSystemIdentifier#2233161, PDModelCode#2233167, LastPerformingPDModelCode#2233168, CounterpartyID#2233206, ... 34 more fields]
      :  :  +- SubqueryAlias EXMP_FAC_RC
      :  :     +- Join LeftOuter, ((((((((((((reporting_entity_id#2233245 = ReportingEntity#2233067) OR (reporting_entity_id#2233245 = *)) AND ((b2_pd_type_id#2233246 = BaselIIProductType#2233005) OR (b2_p..."
	debug_error_string = "UNKNOWN:Error received from peer  {created_time:"2025-08-12T12:26:05.361934597+00:00", grpc_status:13, grpc_message:"[UNRESOLVED_COLUMN.WITH_SUGGESTION] A column, variable, or function parameter with name `CF`.`LocalFacilityIdentifier` cannot be resolved. Did you mean one of the following? [`EXMP_FAC_RC`.`LocalFacilityIdentifier`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`LocalId`, `EXMP_FAC_RC`.`PDModelCode`]. SQLSTATE: 42703; line 1 pos 59;\n\'Project [*, \'min(\'EXMP_CP_RC_JOINED.ExemptionConditionIdRC) windowspecdefinition(\'EXMP_FAC_RC.LocalFacilityIdentifier, unspecifiedframe$()) AS var_lowest_ExemptionClaimConditonID_CP_RC#2232730]\n+- \'SubqueryAlias EXMP_CP_RC_JOINED\n   +- \'Join LeftOuter, \'and((\'INT_CF_LINKS.ParticipatingCounterparty = \'EXMP_CP_RC.CounterpartyID), (\'INT_CF_LINKS.ParticipatingCounterpartySourceSystemIdentifier = \'EXMP_CP_RC.CounterpartySourceSystemIdentifier))\n      :- \'Join LeftOuter, \'and((\'CF.LocalFacilityIdentifier = \'INT_CF_LINKS.CreditFacility), (\'CF.SourceSystemIdentifier = \'INT_CF_LINKS.CreditFacilitySourceSystemIdentifier))\n      :  :- \'Project [DeliveryEntity#2232988, ReportingDate#2232989, ReportingEntity#2233067, LocalFacilityIdentifier#2232990, SourceSystemIdentifier#2233070, CounterpartyID#2233088, CounterpartySourceSystemIdentifier#2233089, BaselIIProductType#2233005, PlNplIndicator#2233063, ProductProgram#2233065, SpecialisedLendingType#2233071, ExemptionFromAdvancedInternalRatingBasedApproach#2233031, SubFacilityFlag#2233087, DeliveryEntity#2233090, ReportingDate#2233091, LocalId#2233118, SourceSystemIdentifier#2233141, GlobalCounterpartyIdentifier#2233111, BaselIICounterpartyType#2233100, ExemptionFromAdvancedInternalRatingBasedApproach#2233109, CounterpartyID#2233160, CounterpartySourceSystemIdentifier#2233161, PDModelCode#2233167, LastPerformingPDModelCode#2233168, CounterpartyID#2233206, ... 34 more fields]\n      :  :  +- SubqueryAlias EXMP_FAC_RC\n      :  :     +- Join LeftOuter, ((((((((((((reporting_entity_id#2233245 = ReportingEntity#2233067) OR (reporting_entity_id#2233245 = *)) AND ((b2_pd_type_id#2233246 = BaselIIProductType#2233005) OR (b2_p..."}"
>
