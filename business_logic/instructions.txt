{"ts": "2025-08-12 10:01:17.133", "level": "ERROR", "logger": "SQLQueryContextLogger", "msg": "[UNRESOLVED_COLUMN.WITH_SUGGESTION] A column, variable, or function parameter with name `CF`.`LocalFacilityIdentifier` cannot be resolved. Did you mean one of the following? [`EXMP_FAC_RC`.`LocalFacilityIdentifier`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`LocalId`, `EXMP_FAC_RC`.`PDModelCode`]. SQLSTATE: 42703; line 1 pos 59;\n'Project [*, 'min('EXMP_CP_RC_JOINED.ExemptionConditionIdRC) windowspecdefinition('CF.LocalFacilityIdentifier, unspecifiedframe$()) AS var_lowest_ExemptionClaimConditonID_CP_RC#13259433]\n+- 'SubqueryAlias EXMP_CP_RC_JOINED\n   +- 'Join LeftOuter, 'and(('INT_CF_LINKS.ParticipatingCounterparty = 'EXMP_CP_RC.CounterpartyID), ('INT_CF_LINKS.ParticipatingCounterpartySourceSystemIdentifier = 'EXMP_CP_RC.CounterpartySourceSystemIdentifier))\n      :- 'Join LeftOuter, 'and(('CF.LocalFacilityIdentifier = 'INT_CF_LINKS.CreditFacility), ('CF.SourceSystemIdentifier = 'INT_CF_LINKS.CreditFacilitySourceSystemIdentifier))\n      :  :- 'Project [DeliveryEntity#13259597, ReportingDate#13259598, ReportingEntity#13259676, LocalFacilityIdentifier#13259599, SourceSystemIdentifier#13259679, CounterpartyID#13259697, CounterpartySourceSystemIdentifier#13259698, BaselIIProductType#13259614, PlNplIndicator#13259672, ProductProgram#13259674, SpecialisedLendingType#13259680, ExemptionFromAdvancedInternalRatingBasedApproach#13259640, SubFacilityFlag#13259696, DeliveryEntity#13259793, ReportingDate#13259794, LocalId#13259821, SourceSystemIdentifier#13259844, GlobalCounterpartyIdentifier#13259814, BaselIICounterpartyType#13259803, ExemptionFromAdvancedInternalRatingBasedApproach#13259812, CounterpartyID#13259863, CounterpartySourceSystemIdentifier#13259864, PDModelCode#13259870, LastPerformingPDModelCode#13259871, CounterpartyID#13259888, ... 34 more fields]\n      :  :  +- SubqueryAlias EXMP_FAC_RC\n      :  :     +- Join LeftOuter, ((((((((((((reporting_entity_id#13259948 = ReportingEntity#13259676) OR (reporting_entity_id#13259948 = *)) AND ((b2_pd_type_id#13259949 = BaselIIProductType#13259614) OR (b2_pd_type_id#13259949 = *))) AND ((lgd_rtg_model#13259954 = LGDModelCode#13259932) OR (lgd_rtg_model#13259954 = *))) AND ((pl_npl_indicator#13259966 = PlNplIndicator#13259672) OR (pl_npl_indicator#13259966 = *))) AND ((specialised_lending_type#13259967 = SpecialisedLendingType#13259680) OR (specialised_lending_type#13259967 = *))) AND ((cr_pd_program#13259952 = ProductProgram#13259674) OR (cr_pd_program#13259952 = *))) AND (((pd_rtg_model#13259947 = PDModelCode#13259870) OR (pd_rtg_model#13259947 = LastPerformingPDModelCode#13259871)) OR (pd_rtg_model#13259947 = *))) AND ((b2_cpty_type_id#13259951 = BaselIICounterpartyType#13259803) OR (b2_cpty_type_id#13259951 = *))) AND (((intercompany_flag#13259957 = InterCompanyFlag#13259892) = cast(Y as boolean)) OR (intercompany_flag#13259957 = *))) AND ((upper(sourced_exemption_id#13259965) = upper(coalesce(ExemptionFromAdvancedInternalRatingBasedApproach#13259640, ExemptionFromAdvancedInternalRatingBasedApproach#13259812))) OR (sourced_exemption_id#13259965 = *))) AND (((concat(ctpty_ssc#13259959, ctpty_uid#13259958) = LocalId#13259821) OR ((ctpty_ssc#13259959 = EPR) AND (ltrim(ctpty_uid#13259958, Some(0)) = ltrim(GlobalCounterpartyIdentifier#13259814, Some(0))))) OR (ctpty_uid#13259958 = *)))\n      :  :        :- Join LeftOuter, ((LocalFacilityIdentifier#13259599 = CreditFacilityID#13259924) AND (SourceSystemIdentifier#13259679 = CreditFacilitySourceSystemIdentifier#13259925))\n      :  :        :  :- Join LeftOuter, ((CounterpartyID#13259697 = CounterpartyID#13259888) AND (CounterpartySourceSystemIdentifier#13259698 = CounterpartySourceSystemIdentifier#13259889))\n      :  :        :  :  :- Join LeftOuter, ((CounterpartyID#13259697 = CounterpartyID#13259863) AND (CounterpartySourceSystemIdentifier#13259698 = CounterpartySourceSystemIdentifier#13259864))\n      :  :        :  :  :  :- Join LeftOuter, ((CounterpartyID#13259697 = LocalId#13259821) AND (CounterpartySourceSystemIdentifier#13259698 = SourceSystemIdentifier#13259844))\n      :  :        :  :  :  :  :- SubqueryAlias CF\n      :  :        :  :  :  :  :  +- Project [DeliveryEntity#13259597, ReportingDate#13259598, ReportingEntity#13259676, LocalFacilityIdentifier#13259599, SourceSystemIdentifier#13259679, CounterpartyID#13259697, CounterpartySourceSystemIdentifier#13259698, BaselIIProductType#13259614, PlNplIndicator#13259672, ProductProgram#13259674, SpecialisedLendingType#13259680, ExemptionFromAdvancedInternalRatingBasedApproach#13259640, SubFacilityFlag#13259696]\n      :  :        :  :  :  :  :     +- Filter (SubFacilityFlag#13259696 = N)\n      :  :        :  :  :  :  :        +- SubqueryAlias bsrc_d.int_202505.mainbank_integrated_creditfacility\n      :  :        :  :  :  :  :           +- Relation bsrc_d.int_202505.mainbank_integrated_creditfacility[DeliveryEntity#13259597,ReportingDate#13259598,LocalFacilityIdentifier#13259599,Default#13259600,DefaultDate#13259601,DefaultEndDate#13259602,NonperformingEndDate#13259603,NonperformingStartDate#13259604,PerformingIndicator#13259605,AccruedFeesAmountDebitCreditIndicator#13259606,AccruedFeesAmountReportingAmount#13259607,AccruedFeesAmountReportingCurrency#13259608,AccruedFeesAmountTransactionAmount#13259609,AccruedFeesAmountTransactionCurrency#13259610,AlternativeLocalReferenceIdentifier#13259611,ApprovedLossGivenDefaultRatingDate#13259612,ArrangementParticipationType#13259613,BaselIIProductType#13259614,BookType#13259615,BorrowingBaseReportingAmount#13259616,BorrowingBaseReportingCurrency#13259617,BorrowingBaseTransactionAmount#13259618,BorrowingBaseTransactionCurrency#13259619,BusinessSegment#13259620,ContractStatus#13259621,... 77 more fields] parquet\n      :  :        :  :  :  :  +- SubqueryAlias INT_CP\n      :  :        :  :  :  :     +- Project [DeliveryEntity#13259793, ReportingDate#13259794, LocalId#13259821, SourceSystemIdentifier#13259844, GlobalCounterpartyIdentifier#13259814, BaselIICounterpartyType#13259803, ExemptionFromAdvancedInternalRatingBasedApproach#13259812]\n      :  :        :  :  :  :        +- SubqueryAlias bsrc_d.int_202505.mainbank_integrated_counterparty\n      :  :        :  :  :  :           +- Relation bsrc_d.int_202505.mainbank_integrated_counterparty[DeliveryEntity#13259793,ReportingDate#13259794,AacAlphaCode#13259795,AlternativeLocalReferenceIdentifier#13259796,AnnualTurnoverReportingAmount#13259797,AnnualTurnoverReportingCurrency#13259798,AnnualTurnoverTransactionAmount#13259799,AnnualTurnoverTransactionCurrency#13259800,ApprovedUniformCounterpartyRating#13259801,ApprovedUniformCounterpartyRatingExpirationDate#13259802,BaselIICounterpartyType#13259803,BcdbId#13259804,CommonEquityTier1Ratio#13259805,CounterpartyName#13259806,CountryOfIncorporation#13259807,CountryOfResidence#13259808,Default#13259809,DefaultDate#13259810,DefaultEndDate#13259811,ExemptionFromAdvancedInternalRatingBasedApproach#13259812,FrCounterpartySegmentation#13259813,GlobalCounterpartyIdentifier#13259814,GlobalOrganisationID#13259815,ImmediateParentOrganisation#13259816,ImmediateParentOrganisationIndicator#13259817,... 43 more fields] parquet\n      :  :        :  :  :  +- SubqueryAlias PD_UCR\n      :  :        :  :  :     +- Project [CounterpartyID#13259863, CounterpartySourceSystemIdentifier#13259864, PDModelCode#13259870, LastPerformingPDModelCode#13259871]\n      :  :        :  :  :        +- SubqueryAlias bsrc_d.int_202505.mainbank_pd_ucr_step3\n      :  :        :  :  :           +- Relation bsrc_d.int_202505.mainbank_pd_ucr_step3[DeliveryEntity#13259861,ReportingDate#13259862,CounterpartyID#13259863,CounterpartySourceSystemIdentifier#13259864,BcdbId#13259865,AacAlphaCode#13259866,GlobalCounterpartyIdentifier#13259867,InterCompanyIndicator#13259868,Default#13259869,PDModelCode#13259870,LastPerformingPDModelCode#13259871,ApprovedUniformCounterpartyRating#13259872,UCRStep1#13259873,UCRStep2#13259874,UniformCounterpartyRating#13259875,ProbabilityOfDefaultBeforeConservatism#13259876,ProbabilityOfDefault#13259877,UniformCounterpartyRatingDate#13259878,UniformCounterpartyRatingExpiryDate#13259879,PDMarginOfConservatism#13259880,UCRCase#13259881,RatingSourceCounterpartyID#13259882,RatingSourceCounterpartySourceSystemIdentifier#13259883,fairid#13259884,UniquePDRatingId#13259885,... 1 more fields] parquet\n      :  :        :  :  +- SubqueryAlias IC\n      :  :        :  :     +- Project [CounterpartyID#13259888, CounterpartySourceSystemIdentifier#13259889, InterCompanyFlag#13259892]\n      :  :        :  :        +- SubqueryAlias bsrc_d.int_202505.mainbank_intercompany\n      :  :        :  :           +- Relation bsrc_d.int_202505.mainbank_intercompany[DeliveryEntity#13259887,CounterpartyID#13259888,CounterpartySourceSystemIdentifier#13259889,InsighterId#13259890,GlobalCounterpartyIdentifier#13259891,InterCompanyFlag#13259892,CounterpartyName#13259893,BaselCounterpartyType#13259894,CountryOfIncorporation#13259895,RealCompanyActivitySector#13259896,UltimateParent#13259897,ReportingEntity#13259898,InterCompanyType#13259899] parquet\n      :  :        :  +- SubqueryAlias LGD\n      :  :        :     +- Project [CreditFacilityID#13259924, CreditFacilitySourceSystemIdentifier#13259925, CounterpartyID#13259927, CounterpartySourceSystemIdentifier#13259928, LGDModelCode#13259932]\n      :  :        :        +- SubqueryAlias bsrc_d.int_202505.mainbank_lgd\n      :  :        :           +- Relation bsrc_d.int_202505.mainbank_lgd[DeliveryEntity#13259921,ReportingDate#13259922,ReportingEntity#13259923,CreditFacilityID#13259924,CreditFacilitySourceSystemIdentifier#13259925,GlobalFacilityIdentifier#13259926,CounterpartyID#13259927,CounterpartySourceSystemIdentifier#13259928,BaselCounterpartyType#13259929,ProbabilityOfDefaultModel#13259930,PlNplIndicator#13259931,LGDModelCode#13259932,LGDSubModelCode#13259933,LGDClass#13259934,DownturnLossGivenDefault#13259935,ThroughTheCycleLossGivenDefault#13259936,LossGivenDefaultRatingApprovalDate#13259937,LossGivenDefaultExpiryDate#13259938,LGDMarginOfConservatism#13259939,LGDType#13259940,LGDSource#13259941] parquet\n      :  :        +- SubqueryAlias `1286EXMP`\n      :  :           +- Project [EXEMPTION_CONDITION_ID#13259942, EXEMPTION_ID#13259943, EXEMPTION_NAME#13259944, EXEMPTION_END_DATE#13259945, SOURCE_SYS_COMP_ID#13259946, PD_RTG_MODEL#13259947, REPORTING_ENTITY_ID#13259948, B2_PD_TYPE_ID#13259949, RPRT_CAR_ACCCODE_ID#13259950, B2_CPTY_TYPE_ID#13259951, CR_PD_PROGRAM#13259952, CUSTOMER_MARKET_SEGMENT_ID#13259953, LGD_RTG_MODEL#13259954, LEGAL_ENTITY#13259955, EX_FBN_FLAG#13259956, INTERCOMPANY_FLAG#13259957, CTPTY_UID#13259958, CTPTY_SSC#13259959, BASEL_APPROACH#13259960, EC_MODEL_INPUT_INDICATOR#13259961, EC_PROXIED_INDICATOR#13259962, TIME_STAMP#13259963, MIN_TURNOVER#13259964, SOURCED_EXEMPTION_ID#13259965, PL_NPL_INDICATOR#13259966, ... 1 more fields]\n      :  :              +- SubqueryAlias bsrc_d.stg_202505.bsl_andes_1286_b2_exmp_cond\n      :  :                 +- Relation bsrc_d.stg_202505.bsl_andes_1286_b2_exmp_cond[EXEMPTION_CONDITION_ID#13259942,EXEMPTION_ID#13259943,EXEMPTION_NAME#13259944,EXEMPTION_END_DATE#13259945,SOURCE_SYS_COMP_ID#13259946,PD_RTG_MODEL#13259947,REPORTING_ENTITY_ID#13259948,B2_PD_TYPE_ID#13259949,RPRT_CAR_ACCCODE_ID#13259950,B2_CPTY_TYPE_ID#13259951,CR_PD_PROGRAM#13259952,CUSTOMER_MARKET_SEGMENT_ID#13259953,LGD_RTG_MODEL#13259954,LEGAL_ENTITY#13259955,EX_FBN_FLAG#13259956,INTERCOMPANY_FLAG#13259957,CTPTY_UID#13259958,CTPTY_SSC#13259959,BASEL_APPROACH#13259960,EC_MODEL_INPUT_INDICATOR#13259961,EC_PROXIED_INDICATOR#13259962,TIME_STAMP#13259963,MIN_TURNOVER#13259964,SOURCED_EXEMPTION_ID#13259965,PL_NPL_INDICATOR#13259966,... 1 more fields] parquet\n      :  +- SubqueryAlias INT_CF_LINKS\n      :     +- Project [DeliveryEntity#13259968, ReportingDate#13259969, CounterpartyRole#13259970, CreditFacility#13259971, CreditFacilitySourceSystemIdentifier#13259972, LiabilityPercentage#13259973, ParticipatingCounterparty#13259974, ParticipatingCounterpartySourceSystemIdentifier#13259975]\n      :        +- SubqueryAlias bsrc_d.int_202505.mainbank_integrated_creditfacility_links\n      :           +- Relation bsrc_d.int_202505.mainbank_integrated_creditfacility_links[DeliveryEntity#13259968,ReportingDate#13259969,CounterpartyRole#13259970,CreditFacility#13259971,CreditFacilitySourceSystemIdentifier#13259972,LiabilityPercentage#13259973,ParticipatingCounterparty#13259974,ParticipatingCounterpartySourceSystemIdentifier#13259975] parquet\n      +- SubqueryAlias EXMP_CP_RC\n         +- Project [DeliveryEntity#13259976, ReportingDate#13259977, CounterpartyID#13259978, CounterpartySourceSystemIdentifier#13259979, GlobalCounterpartyIdentifier#13259980, SourcedExemptionId#13259981, PDModelCode#13259982, LastPerformingPDModelCode#13259983, IntercompanyFlag#13259984, BaselCreditRiskApproach#13259985, ExemptionConditionIdRC#13259986, ExemptionIdRC#13259987, ExemptionNameRC#13259988, ExemptionTypeRC#13259989]\n            +- SubqueryAlias bsrc_d.enrich_202505.mainbank_exemptionclaim_counterparty_rc\n               +- Relation bsrc_d.enrich_202505.mainbank_exemptionclaim_counterparty_rc[DeliveryEntity#13259976,ReportingDate#13259977,CounterpartyID#13259978,CounterpartySourceSystemIdentifier#13259979,GlobalCounterpartyIdentifier#13259980,SourcedExemptionId#13259981,PDModelCode#13259982,LastPerformingPDModelCode#13259983,IntercompanyFlag#13259984,BaselCreditRiskApproach#13259985,ExemptionConditionIdRC#13259986,ExemptionIdRC#13259987,ExemptionNameRC#13259988,ExemptionTypeRC#13259989] parquet\n\n\nJVM stacktrace:\norg.apache.spark.sql.catalyst.ExtendedAnalysisException\n\tat org.apache.spark.sql.errors.QueryCompilationErrors$.unresolvedAttributeError(QueryCompilationErrors.scala:504)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.org$apache$spark$sql$catalyst$analysis$CheckAnalysis$$failUnresolvedAttribute(CheckAnalysis.scala:179)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$10(CheckAnalysis.scala:489)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$10$adapted(CheckAnalysis.scala:474)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:303)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)\n\tat scala.collection.immutable.List.foreach(List.scala:333)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)\n\tat scala.collection.immutable.Vector.foreach(Vector.scala:1895)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)\n\tat scala.collection.immutable.Vector.foreach(Vector.scala:1895)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$9(CheckAnalysis.scala:474)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$9$adapted(CheckAnalysis.scala:474)\n\tat scala.collection.IterableOnceOps.foreach(IterableOnce.scala:575)\n\tat scala.collection.IterableOnceOps.foreach$(IterableOnce.scala:573)\n\tat scala.collection.AbstractIterable.foreach(Iterable.scala:933)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$2(CheckAnalysis.scala:474)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis0$2$adapted(CheckAnalysis.scala:307)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:303)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)\n\tat scala.collection.immutable.Vector.foreach(Vector.scala:1895)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)\n\tat scala.collection.immutable.Vector.foreach(Vector.scala:1895)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)\n\tat scala.collection.immutable.Vector.foreach(Vector.scala:1895)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:302)\n\tat scala.collection.immutable.Vector.foreach(Vector.scala:1895)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:302)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.checkAnalysis0(CheckAnalysis.scala:307)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.checkAnalysis0$(CheckAnalysis.scala:278)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer.checkAnalysis0(Analyzer.scala:416)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis$1(CheckAnalysis.scala:263)\n\tat scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.scala:18)\n\tat com.databricks.spark.util.FrameProfiler$.record(FrameProfiler.scala:94)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.checkAnalysis(CheckAnalysis.scala:250)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis.checkAnalysis$(CheckAnalysis.scala:250)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer.checkAnalysis(Analyzer.scala:416)\n\tat org.apache.spark.sql.catalyst.analysis.resolver.HybridAnalyzer.$anonfun$resolveInFixedPoint$1(HybridAnalyzer.scala:254)\n\tat scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.scala:18)\n\tat org.apache.spark.sql.catalyst.QueryPlanningTracker$.withTracker(QueryPlanningTracker.scala:219)\n\tat org.apache.spark.sql.catalyst.analysis.resolver.HybridAnalyzer.resolveInFixedPoint(HybridAnalyzer.scala:254)\n\tat org.apache.spark.sql.catalyst.analysis.resolver.HybridAnalyzer.$anonfun$apply$1(HybridAnalyzer.scala:96)\n\tat org.apache.spark.sql.catalyst.analysis.resolver.HybridAnalyzer.withTrackedAnalyzerBridgeState(HybridAnalyzer.scala:131)\n\tat org.apache.spark.sql.catalyst.analysis.resolver.HybridAnalyzer.apply(HybridAnalyzer.scala:87)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer.$anonfun$executeAndCheck$1(Analyzer.scala:478)\n\tat org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper$.markInAnalyzer(AnalysisHelper.scala:425)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer.executeAndCheck(Analyzer.scala:478)\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$lazyAnalyzed$3(QueryExecution.scala:294)\n\tat com.databricks.spark.util.FrameProfiler$.record(FrameProfiler.scala:94)\n\tat org.apache.spark.sql.catalyst.QueryPlanningTracker.measurePhase(QueryPlanningTracker.scala:548)\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$5(QueryExecution.scala:668)\n\tat org.apache.spark.sql.execution.SQLExecution$.withExecutionPhase(SQLExecution.scala:151)\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$4(QueryExecution.scala:668)\n\tat org.apache.spark.sql.execution.QueryExecution$.withInternalError(QueryExecution.scala:1307)\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$2(QueryExecution.scala:661)\n\tat com.databricks.util.LexicalThreadLocal$Handle.runWith(LexicalThreadLocal.scala:63)\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$1(QueryExecution.scala:658)\n\tat org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:1462)\n\tat org.apache.spark.sql.execution.QueryExecution.executePhase(QueryExecution.scala:658)\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$lazyAnalyzed$2(QueryExecution.scala:288)\n\tat com.databricks.sql.util.MemoryTrackerHelper.withMemoryTracking(MemoryTrackerHelper.scala:80)\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$lazyAnalyzed$1(QueryExecution.scala:287)\n\tat scala.util.Try$.apply(Try.scala:210)\n\tat org.apache.spark.util.Utils$.doTryWithCallerStacktrace(Utils.scala:1684)\n\tat org.apache.spark.util.Utils$.getTryWithCallerStacktrace(Utils.scala:1745)\n\tat org.apache.spark.util.LazyTry.get(LazyTry.scala:58)\n\tat org.apache.spark.sql.execution.QueryExecution.analyzed(QueryExecution.scala:321)\n\tat org.apache.spark.sql.execution.QueryExecution.assertAnalyzed(QueryExecution.scala:267)\n\tat org.apache.spark.sql.Dataset$.$anonfun$ofRows$1(Dataset.scala:108)\n\tat org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:1462)\n\tat org.apache.spark.sql.SparkSession.$anonfun$withActiveAndFrameProfiler$1(SparkSession.scala:1469)\n\tat com.databricks.spark.util.FrameProfiler$.record(FrameProfiler.scala:94)\n\tat org.apache.spark.sql.SparkSession.withActiveAndFrameProfiler(SparkSession.scala:1469)\n\tat org.apache.spark.sql.Dataset$.ofRows(Dataset.scala:106)\n\tat org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.process(SparkConnectAnalyzeHandler.scala:137)\n\tat org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.$anonfun$handle$3(SparkConnectAnalyzeHandler.scala:104)\n\tat org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.$anonfun$handle$3$adapted(SparkConnectAnalyzeHandler.scala:66)\n\tat org.apache.spark.sql.connect.service.SessionHolder.$anonfun$withSession$2(SessionHolder.scala:464)\n\tat org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:1462)\n\tat org.apache.spark.sql.connect.service.SessionHolder.$anonfun$withSession$1(SessionHolder.scala:464)\n\tat org.apache.spark.JobArtifactSet$.withActiveJobArtifactState(JobArtifactSet.scala:97)\n\tat org.apache.spark.sql.artifact.ArtifactManager.$anonfun$withResources$1(ArtifactManager.scala:90)\n\tat org.apache.spark.util.Utils$.withContextClassLoader(Utils.scala:241)\n\tat org.apache.spark.sql.artifact.ArtifactManager.withResources(ArtifactManager.scala:89)\n\tat org.apache.spark.sql.connect.service.SessionHolder.withSession(SessionHolder.scala:463)\n\tat org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.$anonfun$handle$1(SparkConnectAnalyzeHandler.scala:66)\n\tat org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.$anonfun$handle$1$adapted(SparkConnectAnalyzeHandler.scala:51)\n\tat com.databricks.spark.connect.logging.rpc.SparkConnectRpcMetricsCollectorUtils$.collectMetrics(SparkConnectRpcMetricsCollector.scala:258)\n\tat org.apache.spark.sql.connect.service.SparkConnectAnalyzeHandler.handle(SparkConnectAnalyzeHandler.scala:50)\n\tat org.apache.spark.sql.connect.service.SparkConnectService.analyzePlan(SparkConnectService.scala:109)\n\tat org.apache.spark.connect.proto.SparkConnectServiceGrpc$MethodHandlers.invoke(SparkConnectServiceGrpc.java:801)\n\tat grpc_shaded.io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)\n\tat grpc_shaded.io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)\n\tat grpc_shaded.io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)\n\tat grpc_shaded.io.grpc.ForwardingServerCallListener$SimpleForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:40)\n\tat grpc_shaded.io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)\n\tat grpc_shaded.io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)\n\tat grpc_shaded.io.grpc.ForwardingServerCallListener$SimpleForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:40)\n\tat com.databricks.spark.connect.service.AuthenticationInterceptor$AuthenticatedServerCallListener.$anonfun$onHalfClose$1(AuthenticationInterceptor.scala:381)\n\tat scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.scala:18)\n\tat com.databricks.unity.UCSEphemeralState$Handle.runWith(UCSEphemeralState.scala:51)\n\tat com.databricks.unity.HandleImpl.runWith(UCSHandle.scala:104)\n\tat com.databricks.spark.connect.service.RequestContext.$anonfun$runWith$3(RequestContext.scala:337)\n\tat com.databricks.spark.connect.service.RequestContext$.com$databricks$spark$connect$service$RequestContext$$withLocalProperties(RequestContext.scala:537)\n\tat com.databricks.spark.connect.service.RequestContext.$anonfun$runWith$2(RequestContext.scala:337)\n\tat com.databricks.logging.AttributionContextTracing.$anonfun$withAttributionContext$1(AttributionContextTracing.scala:49)\n\tat com.databricks.logging.AttributionContext$.$anonfun$withValue$1(AttributionContext.scala:293)\n\tat scala.util.DynamicVariable.withValue(DynamicVariable.scala:59)\n\tat com.databricks.logging.AttributionContext$.withValue(AttributionContext.scala:289)\n\tat com.databricks.logging.AttributionContextTracing.withAttributionContext(AttributionContextTracing.scala:47)\n\tat com.databricks.logging.AttributionContextTracing.withAttributionContext$(AttributionContextTracing.scala:44)\n\tat com.databricks.spark.util.PublicDBLogging.withAttributionContext(DatabricksSparkUsageLogger.scala:30)\n\tat com.databricks.spark.util.UniverseAttributionContextWrapper.withValue(AttributionContextUtils.scala:242)\n\tat com.databricks.spark.connect.service.RequestContext.$anonfun$runWith$1(RequestContext.scala:336)\n\tat com.databricks.spark.connect.service.RequestContext.withContext(RequestContext.scala:349)\n\tat com.databricks.spark.connect.service.RequestContext.runWith(RequestContext.scala:329)\n\tat com.databricks.spark.connect.service.AuthenticationInterceptor$AuthenticatedServerCallListener.onHalfClose(AuthenticationInterceptor.scala:381)\n\tat grpc_shaded.io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:351)\n\tat grpc_shaded.io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:861)\n\tat grpc_shaded.io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)\n\tat grpc_shaded.io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)\n\tat org.apache.spark.util.threads.SparkThreadLocalCapturingRunnable.$anonfun$run$1(SparkThreadLocalForwardingThreadPoolExecutor.scala:165)\n\tat scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.scala:18)\n\tat com.databricks.util.LexicalThreadLocal$Handle.runWith(LexicalThreadLocal.scala:63)\n\tat org.apache.spark.util.threads.SparkThreadLocalCapturingHelper.$anonfun$runWithCaptured$6(SparkThreadLocalForwardingThreadPoolExecutor.scala:119)\n\tat com.databricks.sql.transaction.tahoe.mst.MSTThreadHelper$.runWithMstTxnId(MSTThreadHelper.scala:57)\n\tat org.apache.spark.util.threads.SparkThreadLocalCapturingHelper.$anonfun$runWithCaptured$5(SparkThreadLocalForwardingThreadPoolExecutor.scala:118)\n\tat com.databricks.spark.util.IdentityClaim$.withClaim(IdentityClaim.scala:48)\n\tat org.apache.spark.util.threads.SparkThreadLocalCapturingHelper.$anonfun$runWithCaptured$4(SparkThreadLocalForwardingThreadPoolExecutor.scala:117)\n\tat com.databricks.unity.UCSEphemeralState$Handle.runWith(UCSEphemeralState.scala:51)\n\tat org.apache.spark.util.threads.SparkThreadLocalCapturingHelper.runWithCaptured(SparkThreadLocalForwardingThreadPoolExecutor.scala:116)\n\tat org.apache.spark.util.threads.SparkThreadLocalCapturingHelper.runWithCaptured$(SparkThreadLocalForwardingThreadPoolExecutor.scala:93)\n\tat org.apache.spark.util.threads.SparkThreadLocalCapturingRunnable.runWithCaptured(SparkThreadLocalForwardingThreadPoolExecutor.scala:162)\n\tat org.apache.spark.util.threads.SparkThreadLocalCapturingRunnable.run(SparkThreadLocalForwardingThreadPoolExecutor.scala:165)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat java.lang.Thread.run(Thread.java:840)", "context": {"errorClass": "UNRESOLVED_COLUMN.WITH_SUGGESTION"}, "exception": {"class": "_InactiveRpcError", "msg": "<_InactiveRpcError of RPC that terminated with:\n\tstatus = StatusCode.INTERNAL\n\tdetails = \"[UNRESOLVED_COLUMN.WITH_SUGGESTION] A column, variable, or function parameter with name `CF`.`LocalFacilityIdentifier` cannot be resolved. Did you mean one of the following? [`EXMP_FAC_RC`.`LocalFacilityIdentifier`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`LocalId`, `EXMP_FAC_RC`.`PDModelCode`]. SQLSTATE: 42703; line 1 pos 59;\n'Project [*, 'min('EXMP_CP_RC_JOINED.ExemptionConditionIdRC) windowspecdefinition('CF.LocalFacilityIdentifier, unspecifiedframe$()) AS var_lowest_ExemptionClaimConditonID_CP_RC#13259433]\n+- 'SubqueryAlias EXMP_CP_RC_JOINED\n   +- 'Join LeftOuter, 'and(('INT_CF_LINKS.ParticipatingCounterparty = 'EXMP_CP_RC.CounterpartyID), ('INT_CF_LINKS.ParticipatingCounterpartySourceSystemIdentifier = 'EXMP_CP_RC.CounterpartySourceSystemIdentifier))\n      :- 'Join LeftOuter, 'and(('CF.LocalFacilityIdentifier = 'INT_CF_LINKS.CreditFacility), ('CF.SourceSystemIdentifier = 'INT_CF_LINKS.CreditFacilitySourceSystemIdentifier))\n      :  :- 'Project [DeliveryEntity#13259597, ReportingDate#13259598, ReportingEntity#13259676, LocalFacilityIdentifier#13259599, SourceSystemIdentifier#13259679, CounterpartyID#13259697, CounterpartySourceSystemIdentifier#13259698, BaselIIProductType#13259614, PlNplIndicator#13259672, ProductProgram#13259674, SpecialisedLendingType#13259680, ExemptionFromAdvancedInternalRatingBasedApproach#13259640, SubFacilityFlag#13259696, DeliveryEntity#13259793, ReportingDate#13259794, LocalId#13259821, SourceSystemIdentifier#13259844, GlobalCounterpartyIdentifier#13259814, BaselIICounterpartyType#13259803, ExemptionFromAdvancedInternalRatingBasedApproach#13259812, CounterpartyID#13259863, CounterpartySourceSystemIdentifier#13259864, PDModelCode#13259870, LastPerformingPDModelCode#13259871, CounterpartyID#13259888, ... 34 more fields]\n      :  :  +- SubqueryAlias EXMP_FAC_RC\n      :  :     +- Join LeftOuter, ((((((((((((reporting_entity_id#13259948 = ReportingEntity#13259676) OR (reporting_entity_id#13259948 = *)) AND ((b2_pd_type_id#13259949 = BaselIIProductT...\"\n\tdebug_error_string = \"UNKNOWN:Error received from peer  {grpc_message:\"[UNRESOLVED_COLUMN.WITH_SUGGESTION] A column, variable, or function parameter with name `CF`.`LocalFacilityIdentifier` cannot be resolved. Did you mean one of the following? [`EXMP_FAC_RC`.`LocalFacilityIdentifier`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`DeliveryEntity`, `EXMP_FAC_RC`.`LocalId`, `EXMP_FAC_RC`.`PDModelCode`]. SQLSTATE: 42703; line 1 pos 59;\\n\\'Project [*, \\'min(\\'EXMP_CP_RC_JOINED.ExemptionConditionIdRC) windowspecdefinition(\\'CF.LocalFacilityIdentifier, unspecifiedframe$()) AS var_lowest_ExemptionClaimConditonID_CP_RC#13259433]\\n+- \\'SubqueryAlias EXMP_CP_RC_JOINED\\n   +- \\'Join LeftOuter, \\'and((\\'INT_CF_LINKS.ParticipatingCounterparty = \\'EXMP_CP_RC.CounterpartyID), (\\'INT_CF_LINKS.ParticipatingCounterpartySourceSystemIdentifier = \\'EXMP_CP_RC.CounterpartySourceSystemIdentifier))\\n      :- \\'Join LeftOuter, \\'and((\\'CF.LocalFacilityIdentifier = \\'INT_CF_LINKS.CreditFacility), (\\'CF.SourceSystemIdentifier = \\'INT_CF_LINKS.CreditFacilitySourceSystemIdentifier))\\n      :  :- \\'Project [DeliveryEntity#13259597, ReportingDate#13259598, ReportingEntity#13259676, LocalFacilityIdentifier#13259599, SourceSystemIdentifier#13259679, CounterpartyID#13259697, CounterpartySourceSystemIdentifier#13259698, BaselIIProductType#13259614, PlNplIndicator#13259672, ProductProgram#13259674, SpecialisedLendingType#13259680, ExemptionFromAdvancedInternalRatingBasedApproach#13259640, SubFacilityFlag#13259696, DeliveryEntity#13259793, ReportingDate#13259794, LocalId#13259821, SourceSystemIdentifier#13259844, GlobalCounterpartyIdentifier#13259814, BaselIICounterpartyType#13259803, ExemptionFromAdvancedInternalRatingBasedApproach#13259812, CounterpartyID#13259863, CounterpartySourceSystemIdentifier#13259864, PDModelCode#13259870, LastPerformingPDModelCode#13259871, CounterpartyID#13259888, ... 34 more fields]\\n      :  :  +- SubqueryAlias EXMP_FAC_RC\\n      :  :     +- Join LeftOuter, ((((((((((((reporting_entity_id#13259948 = ReportingEntity#13259676) OR (reporting_entity_id#13259948 = *)) AND ((b2_pd_type_id#13259949 = BaselIIProductT...\", grpc_status:13, created_time:\"2025-08-12T10:01:17.12654449+00:00\"}\"\n>", "stacktrace": [{"class": null, "method": "_analyze", "file": "/databricks/spark/python/pyspark/sql/connect/client/core.py", "line": "1736"}, {"class": null, "method": "__call__", "file": "/databricks/python/lib/python3.12/site-packages/grpc/_interceptor.py", "line": "277"}, {"class": null, "method": "_with_call", "file": "/databricks/python/lib/python3.12/site-packages/grpc/_interceptor.py", "line": "332"}, {"class": null, "method": "result", "file": "/databricks/python/lib/python3.12/site-packages/grpc/_channel.py", "line": "437"}, {"class": null, "method": "continuation", "file": "/databricks/python/lib/python3.12/site-packages/grpc/_interceptor.py", "line": "315"}, {"class": null, "method": "with_call", "file": "/databricks/python/lib/python3.12/site-packages/grpc/_channel.py", "line": "1177"}, {"class": null, "method": "_end_unary_response_blocking", "file": "/databricks/python/lib/python3.12/site-packages/grpc/_channel.py", "line": "1003"}]}}
